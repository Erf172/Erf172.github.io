<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>某咸鱼的鱼缸</title>
  
  <subtitle>日常生(翻)活(车)的记录史</subtitle>
  <link href="/blog/atom.xml" rel="self"/>
  
  <link href="/"/>
  <updated>2019-09-11T10:54:29.940Z</updated>
  <id>/</id>
  
  <author>
    <name>这不是lD</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>使用用DS1302写一个简单的时钟</title>
    <link href="/2019/09/12/SDCC-MCS51-DS1302-Clock/"/>
    <id>/2019/09/12/SDCC-MCS51-DS1302-Clock/</id>
    <published>2019-09-11T18:33:10.000Z</published>
    <updated>2019-09-11T10:54:29.940Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>用定时器写完时钟后，开发板上的DS1302自然是不能放过，看了半天文档，差不多写出来了，特此记录一下下吧</p></blockquote><a id="more"></a><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>一个利用<a href="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=fc89btL4nuJfUM4XErIxBuX6BfAk3UCt55GfLG7MSDM5ZdQMDXbkkwXAOomXTsls5Z80JmNtYhzIQjiqWJnbXRZQFvJYVO0eniOXJSQ5fSuImFzr7DNpDNoinBa7uMKkOw&amp;file_name=/ds1302.pdf" target="_blank" rel="noopener">DS1302</a>模块所写的一个简单的时钟，使用的是普中的开发板</p><p>只能够实现基本的计时功能</p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><blockquote><p>main.c 主程序<br>ds1302.c 驱动ds1302模块<br>led_1602.c 驱动1602液晶</p></blockquote><h4 id="main-c"><a href="#main-c" class="headerlink" title="main.c"></a>main.c</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"led_1602.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ds1302.h"</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;at89x52.h&gt;</span></span></span><br><span class="line"></span><br><span class="line">uint i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display_time_week</span><span class="params">(uint cl_week,uint w_local)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display_time_date</span><span class="params">(uint *timep)</span></span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span> <span class="params">(uint xms)</span></span>;</span><br><span class="line"></span><br><span class="line">uchar dis_wel[]=<span class="string">"Welcome!"</span>;</span><br><span class="line">uchar dis_blog[]=<span class="string">"www.erf172.tk"</span>;</span><br><span class="line">uchar dis_week[]=<span class="string">"SunMonTueWedThuFriSat"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> uint *TIME_P;</span><br><span class="line"></span><br><span class="line">uint time[<span class="number">7</span>]=&#123;<span class="number">0x00</span>,<span class="number">0x51</span>,<span class="number">0x17</span>,<span class="number">0x11</span>,<span class="number">0x09</span>,<span class="number">3</span>,<span class="number">0x19</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    TIME_P=time;</span><br><span class="line"></span><br><span class="line">    _1602_init();</span><br><span class="line">    _1602_command(<span class="number">0x80</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(dis_blog[i]!=<span class="string">'\0'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _1602_data(dis_blog[i]);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _1602_command(<span class="number">0xc0</span>);</span><br><span class="line">    i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(dis_wel[i]!=<span class="string">'\0'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _1602_data(dis_wel[i]);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    delay(<span class="number">5000</span>);</span><br><span class="line"></span><br><span class="line">    Ds1302Init();</span><br><span class="line"></span><br><span class="line">    _1602_command(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)&#123;</span><br><span class="line">    </span><br><span class="line">        Ds1302ReadTime();</span><br><span class="line">        </span><br><span class="line">        display_time_date(TIME_P);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;   </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display_time_date</span><span class="params">(uint *timep)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    uint i=<span class="number">0</span>;</span><br><span class="line">    uchar time_display_date[<span class="number">10</span>]=&#123;<span class="string">'2'</span>,<span class="string">'0'</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="string">'/'</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="string">'/'</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    uchar time_display_clock[<span class="number">8</span>]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="string">':'</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="string">':'</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    uchar time_display_week=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    time_display_date[<span class="number">2</span>]=*(timep+<span class="number">6</span>)/<span class="number">16</span>+<span class="string">'0'</span>;</span><br><span class="line">    time_display_date[<span class="number">3</span>]=*(timep+<span class="number">6</span>)%<span class="number">16</span>+<span class="string">'0'</span>;</span><br><span class="line">    </span><br><span class="line">    time_display_date[<span class="number">5</span>]=*(timep+<span class="number">4</span>)/<span class="number">16</span>+<span class="string">'0'</span>;</span><br><span class="line">    time_display_date[<span class="number">6</span>]=*(timep+<span class="number">4</span>)%<span class="number">16</span>+<span class="string">'0'</span>;</span><br><span class="line"></span><br><span class="line">    time_display_date[<span class="number">8</span>]=*(timep+<span class="number">3</span>)/<span class="number">16</span>+<span class="string">'0'</span>;</span><br><span class="line">    time_display_date[<span class="number">9</span>]=*(timep+<span class="number">3</span>)%<span class="number">16</span>+<span class="string">'0'</span>;</span><br><span class="line"></span><br><span class="line">    time_display_clock[<span class="number">0</span>]=*(timep+<span class="number">2</span>)/<span class="number">16</span>+<span class="string">'0'</span>;</span><br><span class="line">    time_display_clock[<span class="number">1</span>]=*(timep+<span class="number">2</span>)%<span class="number">16</span>+<span class="string">'0'</span>;</span><br><span class="line"></span><br><span class="line">    time_display_clock[<span class="number">3</span>]=*(timep+<span class="number">1</span>)/<span class="number">16</span>+<span class="string">'0'</span>;</span><br><span class="line">    time_display_clock[<span class="number">4</span>]=*(timep+<span class="number">1</span>)%<span class="number">16</span>+<span class="string">'0'</span>;</span><br><span class="line">    </span><br><span class="line">    time_display_clock[<span class="number">6</span>]=*(timep+<span class="number">0</span>)/<span class="number">16</span>+<span class="string">'0'</span>;</span><br><span class="line">    time_display_clock[<span class="number">7</span>]=*(timep+<span class="number">0</span>)%<span class="number">16</span>+<span class="string">'0'</span>;</span><br><span class="line"></span><br><span class="line">    time_display_week=*(timep+<span class="number">5</span>)%<span class="number">7</span>;</span><br><span class="line">    </span><br><span class="line">    _1602_command(<span class="number">0x83</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        _1602_data(time_display_date[i]);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _1602_command(<span class="number">0xc6</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        _1602_data(time_display_clock[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _1602_command(<span class="number">0xc2</span>);</span><br><span class="line">    _1602_data(time_display_week);</span><br><span class="line"></span><br><span class="line">    display_time_week(time_display_week,<span class="number">0xc2</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display_time_week</span><span class="params">(uint cl_week,uint w_local)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    _1602_command(w_local);</span><br><span class="line">    uint j=<span class="number">0</span>;</span><br><span class="line">    j=cl_week*<span class="number">3</span>;</span><br><span class="line">    <span class="keyword">while</span>(j&lt;=cl_week*<span class="number">3</span>+<span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _1602_data(dis_week[j]);</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">delay</span><span class="params">(uint xms)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">int</span> x,y;</span><br><span class="line">    <span class="keyword">for</span>(x=xms;x&gt;<span class="number">0</span>;x--)</span><br><span class="line">        <span class="keyword">for</span>(y=<span class="number">110</span>;y&gt;<span class="number">0</span>;y--);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="ds1302-h"><a href="#ds1302-h" class="headerlink" title="ds1302.h"></a>ds1302.h</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> __DS1302_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __DS1302_H_</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;at89x52.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> uchar</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uchar unsigned char</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> uint </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uint unsigned int</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 定义一下nop，延时一个机器周期 */</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> __nop() __asm__ (<span class="meta-string">"NOP"</span>)</span></span><br><span class="line"></span><br><span class="line">__sbit  __at <span class="number">0xB4</span> _DSIO;</span><br><span class="line">__sbit  __at <span class="number">0xB5</span> _RST;</span><br><span class="line">__sbit  __at <span class="number">0xB6</span> _SCLK;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds1302Write</span><span class="params">(uchar ds1302_addr_w, uchar ds1302_data)</span></span>;</span><br><span class="line"><span class="function">uchar <span class="title">Ds1302Read</span><span class="params">(uchar ds1302_addr_r)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds1302Init</span><span class="params">()</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds1302ReadTime</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">extern</span> uchar clock_address_w[<span class="number">7</span>];</span><br><span class="line"><span class="keyword">extern</span> uchar clock_address_r[<span class="number">7</span>];</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><h4 id="ds1302-c"><a href="#ds1302-c" class="headerlink" title="ds1302.c"></a>ds1302.c</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"ds1302.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">uint *TIME_P;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">uchar clock_address_w[<span class="number">7</span>]=&#123;<span class="number">0x80</span>,<span class="number">0x82</span>,<span class="number">0x84</span>,<span class="number">0x86</span>,<span class="number">0x88</span>,<span class="number">0x8a</span>,<span class="number">0x8c</span>&#125;;</span><br><span class="line">uchar clock_address_r[<span class="number">7</span>]=&#123;<span class="number">0x81</span>,<span class="number">0x83</span>,<span class="number">0x85</span>,<span class="number">0x87</span>,<span class="number">0x89</span>,<span class="number">0x8b</span>,<span class="number">0x8d</span>&#125;;</span><br><span class="line"></span><br><span class="line">uchar *clock_address_p;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds1302Write</span><span class="params">(uchar ds1302_addr_w, uchar ds1302_data)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   uint i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">   _RST=<span class="number">0</span>;</span><br><span class="line">   __nop();</span><br><span class="line"></span><br><span class="line">   _SCLK=<span class="number">0</span>;</span><br><span class="line">   __nop();</span><br><span class="line">   _RST=<span class="number">1</span>;</span><br><span class="line">   __nop();</span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">   &#123;   </span><br><span class="line">       _DSIO=ds1302_addr_w&amp;<span class="number">0x01</span>;</span><br><span class="line">       ds1302_addr_w&gt;&gt;=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">       _SCLK=<span class="number">1</span>;</span><br><span class="line">       __nop();</span><br><span class="line">       _SCLK=<span class="number">0</span>;</span><br><span class="line">       __nop();</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">   &#123;   </span><br><span class="line">       _DSIO=ds1302_data&amp;<span class="number">0x01</span>;</span><br><span class="line">       ds1302_data&gt;&gt;=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line">       _SCLK=<span class="number">1</span>;</span><br><span class="line">       __nop();</span><br><span class="line">       _SCLK=<span class="number">0</span>;</span><br><span class="line">       __nop();</span><br><span class="line"></span><br><span class="line">   &#125;</span><br><span class="line"></span><br><span class="line">   _RST=<span class="number">0</span>;</span><br><span class="line">   __nop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function">uchar <span class="title">Ds1302Read</span><span class="params">(uchar ds1302_addr_r)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">   uint i=<span class="number">0</span>,ds1302_data_r,temp;</span><br><span class="line"></span><br><span class="line">   _RST=<span class="number">0</span>;</span><br><span class="line">   __nop();</span><br><span class="line"></span><br><span class="line">   _SCLK=<span class="number">0</span>;</span><br><span class="line">   __nop();</span><br><span class="line">   _RST=<span class="number">1</span>;</span><br><span class="line">   __nop();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">   <span class="keyword">for</span>(i=<span class="number">0</span>; i&lt;<span class="number">8</span>; i++)</span><br><span class="line">&#123;</span><br><span class="line">_DSIO = ds1302_addr_r &amp; <span class="number">0x01</span>;</span><br><span class="line">ds1302_addr_r &gt;&gt;= <span class="number">1</span>;</span><br><span class="line">_SCLK = <span class="number">1</span>;</span><br><span class="line">__nop();</span><br><span class="line">_SCLK = <span class="number">0</span>;</span><br><span class="line">__nop();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">    __nop();</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">   &#123;</span><br><span class="line">       temp=_DSIO;</span><br><span class="line">       ds1302_data_r= (ds1302_data_r&gt;&gt;<span class="number">1</span>) | (temp&lt;&lt;<span class="number">7</span>);</span><br><span class="line"></span><br><span class="line">       _SCLK=<span class="number">1</span>;</span><br><span class="line">       __nop();</span><br><span class="line">       _SCLK=<span class="number">0</span>;</span><br><span class="line">       __nop();</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">    _RST=<span class="number">0</span>;</span><br><span class="line">    __nop();</span><br><span class="line">    _SCLK=<span class="number">1</span>;</span><br><span class="line">    __nop();</span><br><span class="line">    _DSIO=<span class="number">0</span>;</span><br><span class="line">    __nop();</span><br><span class="line">    _DSIO=<span class="number">1</span>;</span><br><span class="line">    __nop();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> ds1302_data_r;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds1302Init</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">    uint i=<span class="number">0</span>;</span><br><span class="line">    Ds1302Write(<span class="number">0x8e</span>,<span class="number">0</span>);</span><br><span class="line">    clock_address_p=clock_address_w;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        Ds1302Write(*(clock_address_p+i),*(TIME_P+i));</span><br><span class="line">    &#125;</span><br><span class="line">    Ds1302Write(<span class="number">0x8e</span>,<span class="number">0x80</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">Ds1302ReadTime</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">    uint i=<span class="number">0</span>;</span><br><span class="line">    clock_address_p=clock_address_r;</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">7</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        *(TIME_P+i)=Ds1302Read(*(clock_address_p+i));</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="led-1602-h"><a href="#led-1602-h" class="headerlink" title="led_1602.h"></a>led_1602.h</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> _LED_1602_H_</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> _LED_1602_H_</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;at89x52.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> uchar</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uchar unsigned char</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">ifndef</span> uint </span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uint unsigned int</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__sbit __at <span class="number">0xA6</span> _LED_RS;</span><br><span class="line">__sbit __at <span class="number">0xA5</span> _LED_RW;</span><br><span class="line">__sbit __at <span class="number">0xA7</span> _LED_E;</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LED_IO P0</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _1602_busy();</span><br><span class="line"><span class="keyword">void</span> _1602_init();</span><br><span class="line"><span class="keyword">void</span> _1602_command(uint com);</span><br><span class="line"><span class="keyword">void</span> _1602_data(uint data);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">endif</span></span></span><br></pre></td></tr></table></figure><h4 id="led-1602-c"><a href="#led-1602-c" class="headerlink" title="led_1602.c"></a>led_1602.c</h4><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">"led_1602.h"</span></span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _1602_init()</span><br><span class="line">&#123;</span><br><span class="line">    P1=P1&amp;<span class="number">0xf0</span>;</span><br><span class="line">    _1602_command(<span class="number">0x38</span>); </span><br><span class="line">    _1602_command(<span class="number">0x0c</span>);</span><br><span class="line">    _1602_command(<span class="number">0x06</span>);</span><br><span class="line">    _1602_command(<span class="number">0x01</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _1602_command(uint com)</span><br><span class="line">&#123;</span><br><span class="line">    _1602_busy();</span><br><span class="line">    _LED_RS=<span class="number">0</span>;</span><br><span class="line">    _LED_RW=<span class="number">0</span>;</span><br><span class="line">    LED_IO=com;</span><br><span class="line">    _LED_E=<span class="number">1</span>;</span><br><span class="line">    _LED_E=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _1602_data(uint data)</span><br><span class="line">&#123;</span><br><span class="line">    _1602_busy();</span><br><span class="line">    _LED_RS=<span class="number">1</span>;</span><br><span class="line">    _LED_RW=<span class="number">0</span>;</span><br><span class="line">    LED_IO=data;</span><br><span class="line">    _LED_E=<span class="number">1</span>;</span><br><span class="line">    _LED_E=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _1602_busy()    <span class="comment">//忙检测函数，判断bit7是0，允许执行；1禁止</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> sta;      <span class="comment">//</span></span><br><span class="line">    LED_IO = <span class="number">0xff</span>;</span><br><span class="line">    _LED_RS = <span class="number">0</span>;</span><br><span class="line">    _LED_RW = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        _LED_E = <span class="number">1</span>;</span><br><span class="line">        sta = LED_IO;</span><br><span class="line">        _LED_E = <span class="number">0</span>;    <span class="comment">//使能，用完就拉低，释放总线</span></span><br><span class="line">    &#125;<span class="keyword">while</span>(sta &amp; <span class="number">0x80</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="makefile"><a href="#makefile" class="headerlink" title="makefile"></a>makefile</h4><figure class="highlight makefile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">src=<span class="variable">$(<span class="built_in">wildcard</span> ./*.c)</span></span><br><span class="line"></span><br><span class="line">target=project</span><br><span class="line"></span><br><span class="line">cc=sdcc</span><br><span class="line">cflags=-mmcs51 --model-large </span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">main.hex:main.ihx</span></span><br><span class="line">packihx main.ihx &gt; main.hex</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">main.ihx: main.c ds1302.rel led_1602.rel</span></span><br><span class="line"><span class="variable">$(cc)</span>  <span class="variable">$(cflags)</span> main.c ds1302.rel led_1602.rel</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="section">ds1302.rel:ds1302.c</span></span><br><span class="line"><span class="variable">$(cc)</span>  <span class="variable">$(cflags)</span> -c ds1302.c</span><br><span class="line"></span><br><span class="line"><span class="section">led_1602.rel:led_1602.c</span></span><br><span class="line"><span class="variable">$(cc)</span>  <span class="variable">$(cflags)</span> -c led_1602.c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta"><span class="meta-keyword">.PHONY</span>:clean</span></span><br><span class="line"><span class="section">clean:</span></span><br><span class="line">-rm -rf  *.lk *.bin *.asm *.lst *.mem *.rst *.lnk *.rel *.sym *.ihx *.hex *.map</span><br></pre></td></tr></table></figure><h3 id="运行截图"><a href="#运行截图" class="headerlink" title="运行截图"></a>运行截图</h3><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=53f0ACdPU0RwEr4dzOwQnF1AYyZCGKRP4SOhj1Kz3vaDCGFCY2VwUvxbS3SVlC9ehwN9Lb7JbvO8klYlKdX8ClHnlqVcVYskHHI46-SwiJS0Xbs-U6daEWXweh-11mn8bHcB28Iu&amp;file_name=/ds1302.jpeg" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=53f0ACdPU0RwEr4dzOwQnF1AYyZCGKRP4SOhj1Kz3vaDCGFCY2VwUvxbS3SVlC9ehwN9Lb7JbvO8klYlKdX8ClHnlqVcVYskHHI46-SwiJS0Xbs-U6daEWXweh-11mn8bHcB28Iu&amp;file_name=/ds1302.jpeg"></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;用定时器写完时钟后，开发板上的DS1302自然是不能放过，看了半天文档，差不多写出来了，特此记录一下下吧&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="MCS-51" scheme="/categories/MCS-51/"/>
    
    
      <category term="单片机" scheme="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
      <category term="写bug" scheme="/tags/%E5%86%99bug/"/>
    
  </entry>
  
  <entry>
    <title>用51单片机写一个简单的时钟</title>
    <link href="/2019/08/29/SDCC-MCS51-Timer-Clock/"/>
    <id>/2019/08/29/SDCC-MCS51-Timer-Clock/</id>
    <published>2019-08-28T20:33:10.000Z</published>
    <updated>2019-08-31T03:04:06.625Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>学习了一段时间的单片机，觉得自己可以写点东西了，在写了无数个bug后，差不多是可以跑起来了，记录一下下吧。。。</p></blockquote><a id="more"></a><h3 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h3><p>一个利用51的定时中断所写的一个简单的时钟，使用的是普中的开发板</p><p>只能够实现基本的计时功能</p><h3 id="电路图"><a href="#电路图" class="headerlink" title="电路图"></a>电路图</h3><p><del>有 一点丑</del></p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=b2c55QAQyoMuAMqZsyuM02Aku7h4_PSFKvMDp-YM3RAFwO_44TSG_94tppxLJv4vBT5HauYIjncgA9r5MEnivOTBtBYn_QcO2wW30EDIFlHaia6olqZGooILHvI2L5II995_P9cDc76hqnE_&amp;file_name=/1.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=b2c55QAQyoMuAMqZsyuM02Aku7h4_PSFKvMDp-YM3RAFwO_44TSG_94tppxLJv4vBT5HauYIjncgA9r5MEnivOTBtBYn_QcO2wW30EDIFlHaia6olqZGooILHvI2L5II995_P9cDc76hqnE_&amp;file_name=/1.png"></p><h3 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/*</span></span><br><span class="line"><span class="comment">*   名称:   利用51单片机的定时器中断编写一个简易时钟</span></span><br><span class="line"><span class="comment">*   作者:   这不是lD</span></span><br><span class="line"><span class="comment">*   时间：  2019/8/26</span></span><br><span class="line"><span class="comment">*   环境：  VSCode+SDCC</span></span><br><span class="line"><span class="comment">*   blog：  www.erf172.tk</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;at89x52.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uchar unsigned char</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> uint unsigned int</span></span><br><span class="line"></span><br><span class="line">uint tt=<span class="number">0</span>;</span><br><span class="line">uint i;</span><br><span class="line"></span><br><span class="line">uint time_table[<span class="number">6</span>]=&#123;<span class="number">2000</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display_time_day</span><span class="params">(uint cl_year,uint cl_month,uint cl_date,uint d_local)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display_time_clock</span><span class="params">(uint cl_hour,uint cl_min,uint cl_sec,uint c_local)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display_time_week</span><span class="params">(uint cl_week,uint w_local)</span></span>;</span><br><span class="line"><span class="function">uint <span class="title">judge_date</span><span class="params">(uint jd_month,uint jd_year)</span></span>;</span><br><span class="line"><span class="function">uint <span class="title">judge_week</span><span class="params">(uint jd_w_day,uint jd_w_month,uint jd_w_year)</span></span>;</span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_time</span><span class="params">()</span></span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _1602_busy();</span><br><span class="line"><span class="keyword">void</span> _1602_init();</span><br><span class="line"><span class="keyword">void</span> _1602_command(uint com);</span><br><span class="line"><span class="keyword">void</span> _1602_data(uint data);</span><br><span class="line"></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> LED_IO P0</span></span><br><span class="line"></span><br><span class="line">__sbit __at <span class="number">0xA6</span> _LED_RS;</span><br><span class="line">__sbit __at <span class="number">0xA5</span> _LED_RW;</span><br><span class="line">__sbit __at <span class="number">0xA7</span> _LED_E;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">uchar dis_wel[]=<span class="string">"Welcome!"</span>;</span><br><span class="line">uchar dis_blog[]=<span class="string">"www.erf172.tk"</span>;</span><br><span class="line">uchar dis_set[]=<span class="string">"SETTIME"</span>;</span><br><span class="line"></span><br><span class="line">uchar dis_week[]=<span class="string">"SunMonTueWedThuFriSat"</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__sbit __at <span class="number">0x97</span> _KEY_P;</span><br><span class="line">__sbit __at <span class="number">0x95</span> _KEY_D;</span><br><span class="line">__sbit __at <span class="number">0xB5</span> _KEY_NEXT;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    EA=<span class="number">1</span>;<span class="comment">//开总中断</span></span><br><span class="line">TMOD=<span class="number">0x01</span>;</span><br><span class="line">TH0=(<span class="number">65536</span><span class="number">-50000</span>)/<span class="number">256</span>;</span><br><span class="line">TL0=(<span class="number">65536</span><span class="number">-50000</span>)%<span class="number">256</span>;</span><br><span class="line">ET0=<span class="number">1</span>;</span><br><span class="line">TR0=<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    _1602_init();                       <span class="comment">//初始化1602</span></span><br><span class="line">    _1602_command(<span class="number">0x80</span>);</span><br><span class="line"> </span><br><span class="line">    <span class="keyword">while</span>(dis_blog[i]!=<span class="string">'\0'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _1602_data(dis_blog[i]);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _1602_command(<span class="number">0xc0</span>);</span><br><span class="line">    i=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span>(dis_wel[i]!=<span class="string">'\0'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _1602_data(dis_wel[i]);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">while</span>(tt!=<span class="number">80</span>);</span><br><span class="line"></span><br><span class="line">    _1602_command(<span class="number">0x01</span>);</span><br><span class="line">    set_time();</span><br><span class="line">    tt=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">while</span> (<span class="number">1</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        <span class="keyword">if</span>(tt==<span class="number">20</span>)</span><br><span class="line">        &#123;</span><br><span class="line">            tt=<span class="number">0</span>;</span><br><span class="line">            time_table[<span class="number">5</span>]++;</span><br><span class="line">            <span class="keyword">if</span> (time_table[<span class="number">5</span>]==<span class="number">60</span>)</span><br><span class="line">            &#123;</span><br><span class="line">                time_table[<span class="number">5</span>]=<span class="number">0</span>;</span><br><span class="line">                time_table[<span class="number">4</span>]++;</span><br><span class="line">                <span class="keyword">if</span> (time_table[<span class="number">4</span>]==<span class="number">60</span>)</span><br><span class="line">                &#123;</span><br><span class="line">                    time_table[<span class="number">4</span>]=<span class="number">0</span>;</span><br><span class="line">                    time_table[<span class="number">3</span>]++;</span><br><span class="line">                    <span class="keyword">if</span> (time_table[<span class="number">3</span>]==<span class="number">24</span>)</span><br><span class="line">                    &#123;</span><br><span class="line">                        time_table[<span class="number">3</span>]=<span class="number">0</span>;</span><br><span class="line">                        time_table[<span class="number">2</span>]++;                                               </span><br><span class="line">                        <span class="keyword">if</span> (time_table[<span class="number">2</span>]==judge_date(time_table[<span class="number">1</span>],time_table[<span class="number">0</span>]))</span><br><span class="line">                        &#123;   </span><br><span class="line">                            time_table[<span class="number">2</span>]=<span class="number">1</span>;</span><br><span class="line">                            time_table[<span class="number">1</span>]++;</span><br><span class="line">                            <span class="keyword">if</span> (time_table[<span class="number">1</span>]==<span class="number">13</span>)</span><br><span class="line">                            &#123;</span><br><span class="line">                                time_table[<span class="number">1</span>]=<span class="number">1</span>;</span><br><span class="line">                                time_table[<span class="number">0</span>]++;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;                    </span><br><span class="line">                    &#125;                    </span><br><span class="line">                &#125;               </span><br><span class="line">            &#125;</span><br><span class="line">           </span><br><span class="line">            display_time_day(time_table[<span class="number">0</span>],time_table[<span class="number">1</span>],time_table[<span class="number">2</span>],<span class="number">0x83</span>);</span><br><span class="line">            display_time_clock(time_table[<span class="number">3</span>],time_table[<span class="number">4</span>],time_table[<span class="number">5</span>],<span class="number">0xc6</span>);</span><br><span class="line">            uint week=judge_week(time_table[<span class="number">2</span>],time_table[<span class="number">1</span>],time_table[<span class="number">0</span>]);</span><br><span class="line">            display_time_week(week,<span class="number">0xc2</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">set_time</span><span class="params">()</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    i=<span class="number">0</span>;</span><br><span class="line">    uint time_table_simple[<span class="number">6</span>]=&#123;<span class="number">2100</span>,<span class="number">12</span>,<span class="number">31</span>,<span class="number">23</span>,<span class="number">59</span>,<span class="number">59</span>,<span class="number">59</span>&#125;;</span><br><span class="line">    _1602_command(<span class="number">0x80</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span>(i&lt;<span class="number">3</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _1602_data(dis_set[i]);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    _1602_command(<span class="number">0xc0</span>);</span><br><span class="line">    <span class="keyword">while</span>(dis_set[i]!=<span class="string">'\0'</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _1602_data(dis_set[i]);</span><br><span class="line">        i++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    display_time_day(time_table[<span class="number">0</span>],time_table[<span class="number">1</span>],time_table[<span class="number">2</span>],<span class="number">0x86</span>);</span><br><span class="line">    display_time_clock(time_table[<span class="number">3</span>],time_table[<span class="number">4</span>],time_table[<span class="number">5</span>],<span class="number">0xc8</span>);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line"></span><br><span class="line">        time_table_simple[<span class="number">3</span>]=judge_date(time_table[<span class="number">1</span>],time_table[<span class="number">0</span>])<span class="number">-1</span>;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> (_KEY_NEXT)</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="keyword">while</span> (_KEY_P&amp;&amp;_KEY_NEXT&amp;&amp;_KEY_D);      <span class="comment">//只有在任意一个按键低电平的时候才能进行下一一步操作</span></span><br><span class="line">            <span class="keyword">if</span>(!_KEY_P)  time_table[i]++;</span><br><span class="line">            <span class="keyword">if</span>(!_KEY_D)  time_table[i]--;</span><br><span class="line">            <span class="keyword">if</span>(time_table[i]&gt;time_table_simple[i]||time_table[i]==<span class="number">0</span>&amp;&amp;i&lt;<span class="number">3</span>)  time_table[i]=<span class="number">1</span>;</span><br><span class="line">            <span class="keyword">if</span>(time_table[i]&gt;time_table_simple[i]&amp;&amp;i&gt;<span class="number">2</span>)  time_table[i]=<span class="number">0</span>;</span><br><span class="line">            display_time_day(time_table[<span class="number">0</span>],time_table[<span class="number">1</span>],time_table[<span class="number">2</span>],<span class="number">0x86</span>);</span><br><span class="line">            display_time_clock(time_table[<span class="number">3</span>],time_table[<span class="number">4</span>],time_table[<span class="number">5</span>],<span class="number">0xc8</span>);</span><br><span class="line">            <span class="keyword">while</span> (!_KEY_P||!_KEY_D);    <span class="comment">//任意一个键松开时才有反应</span></span><br><span class="line">            <span class="keyword">if</span> (!_KEY_NEXT) <span class="keyword">break</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (!_KEY_NEXT);</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    _1602_command(<span class="number">0x01</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 显示相关 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display_time_day</span><span class="params">(uint cl_year,uint cl_month,uint cl_date,uint d_local)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">/* 显示年月日 格式为 xxxx-xx-xx */</span></span><br><span class="line">    uint dis_date_table[<span class="number">10</span>]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0x2D</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0x2D</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;       <span class="comment">//0x2D 为"="</span></span><br><span class="line">    uint i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 转换成ASCII码需要加0x30 */</span></span><br><span class="line">    dis_date_table[<span class="number">0</span>]=cl_year/<span class="number">1000</span>+<span class="number">0x30</span>;</span><br><span class="line">    dis_date_table[<span class="number">1</span>]=cl_year%<span class="number">1000</span>/<span class="number">100</span>+<span class="number">0x30</span>;</span><br><span class="line">    dis_date_table[<span class="number">2</span>]=cl_year%<span class="number">1000</span>%<span class="number">100</span>/<span class="number">10</span>+<span class="number">0x30</span>;</span><br><span class="line">    dis_date_table[<span class="number">3</span>]=cl_year%<span class="number">1000</span>%<span class="number">100</span>%<span class="number">10</span>+<span class="number">0x30</span>;</span><br><span class="line"></span><br><span class="line">    dis_date_table[<span class="number">5</span>]=cl_month/<span class="number">10</span>+<span class="number">0x30</span>;</span><br><span class="line">    dis_date_table[<span class="number">6</span>]=cl_month%<span class="number">10</span>+<span class="number">0x30</span>;</span><br><span class="line"></span><br><span class="line">    dis_date_table[<span class="number">8</span>]=cl_date/<span class="number">10</span>+<span class="number">0x30</span>;</span><br><span class="line">    dis_date_table[<span class="number">9</span>]=cl_date%<span class="number">10</span>+<span class="number">0x30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 移动当前光标至第一行中间 */</span></span><br><span class="line">    _1602_command(d_local);</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        _1602_data(dis_date_table[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display_time_clock</span><span class="params">(uint cl_hour,uint cl_min,uint cl_sec,uint c_local)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 显示时间 格式 xx:xx:xx */</span></span><br><span class="line">    uint dis_clock_table[]=&#123;<span class="number">0</span>,<span class="number">0</span>,<span class="number">0x3A</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0x3A</span>,<span class="number">0</span>,<span class="number">0</span>&#125;;</span><br><span class="line">    uint i=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 转换成ASCII码需要加0x30 */</span></span><br><span class="line">    dis_clock_table[<span class="number">0</span>]=cl_hour/<span class="number">10</span>+<span class="number">0x30</span>;</span><br><span class="line">    dis_clock_table[<span class="number">1</span>]=cl_hour%<span class="number">10</span>+<span class="number">0x30</span>;</span><br><span class="line"></span><br><span class="line">    dis_clock_table[<span class="number">3</span>]=cl_min/<span class="number">10</span>+<span class="number">0x30</span>;</span><br><span class="line">    dis_clock_table[<span class="number">4</span>]=cl_min%<span class="number">10</span>+<span class="number">0x30</span>;</span><br><span class="line"></span><br><span class="line">    dis_clock_table[<span class="number">6</span>]=cl_sec/<span class="number">10</span>+<span class="number">0x30</span>;</span><br><span class="line">    dis_clock_table[<span class="number">7</span>]=cl_sec%<span class="number">10</span>+<span class="number">0x30</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 移动当前光标至第二行中间 */</span></span><br><span class="line">    _1602_command(c_local);</span><br><span class="line">    <span class="keyword">for</span> ( i = <span class="number">0</span>; i &lt; <span class="number">8</span>; i++)</span><br><span class="line">    &#123;</span><br><span class="line">        _1602_data(dis_clock_table[i]);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">display_time_week</span><span class="params">(uint cl_week,uint w_local)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    _1602_command(w_local);</span><br><span class="line">    uint j=<span class="number">0</span>;</span><br><span class="line">    j=cl_week*<span class="number">3</span>;</span><br><span class="line">    <span class="keyword">while</span>(j&lt;=cl_week*<span class="number">3</span>+<span class="number">2</span>)</span><br><span class="line">    &#123;</span><br><span class="line">        _1602_data(dis_week[j]);</span><br><span class="line">        j++;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 判断当前月份有多少天 */</span></span><br><span class="line"><span class="function">uint <span class="title">judge_date</span><span class="params">(uint jd_month,uint jd_year)</span>            </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    uint jd_date=<span class="number">0</span>;</span><br><span class="line">    <span class="keyword">switch</span> (jd_month)</span><br><span class="line">    &#123;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">1</span>: jd_date=<span class="number">31</span>;  <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">2</span>: </span><br><span class="line">        &#123;   </span><br><span class="line">            <span class="keyword">if</span>((jd_year%<span class="number">4</span>==<span class="number">0</span>&amp;&amp;jd_year%<span class="number">100</span>!=<span class="number">0</span>)||jd_year%<span class="number">400</span>==<span class="number">0</span>)  jd_date=<span class="number">29</span>;         <span class="comment">//判断闰年</span></span><br><span class="line">            <span class="keyword">else</span> jd_date=<span class="number">28</span>; </span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; </span><br><span class="line">    <span class="keyword">case</span> <span class="number">3</span>: jd_date=<span class="number">31</span>;  <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">4</span>: jd_date=<span class="number">30</span>;  <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">5</span>: jd_date=<span class="number">31</span>;  <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">6</span>: jd_date=<span class="number">30</span>;  <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">7</span>: jd_date=<span class="number">31</span>;  <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">8</span>: jd_date=<span class="number">31</span>;  <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">9</span>: jd_date=<span class="number">30</span>;  <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">10</span>: jd_date=<span class="number">31</span>;  <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">11</span>: jd_date=<span class="number">30</span>;  <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">case</span> <span class="number">12</span>: jd_date=<span class="number">31</span>;  <span class="keyword">break</span>;</span><br><span class="line">    <span class="keyword">default</span>:</span><br><span class="line">        <span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> jd_date;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 判断当前日期是星期几 */</span></span><br><span class="line"><span class="function">uint <span class="title">judge_week</span><span class="params">(uint jd_w_day,uint jd_w_month,uint jd_w_year)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"></span><br><span class="line">    uint Year_Sum=<span class="number">0</span>,Month_Sum=<span class="number">0</span>,This_Year_Month=<span class="number">0</span>,jd_w_week=<span class="number">0</span>;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1900/1/1 为星期一</span></span><br><span class="line">    Year_Sum=(jd_w_year<span class="number">-1900</span>)+(jd_w_year<span class="number">-1901</span>)/<span class="number">4</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (This_Year_Month = <span class="number">1</span>; This_Year_Month &lt; jd_w_month; This_Year_Month++)</span><br><span class="line">    &#123;</span><br><span class="line">        Month_Sum=Month_Sum+judge_date(This_Year_Month, jd_w_year);  </span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    jd_w_week=(Year_Sum+jd_w_day+Month_Sum)%<span class="number">7</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> jd_w_week;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/* 驱动1602液晶 */</span></span><br><span class="line"><span class="keyword">void</span> _1602_init()</span><br><span class="line">&#123;</span><br><span class="line">    P1=P1&amp;<span class="number">0xf0</span>;</span><br><span class="line">    _1602_command(<span class="number">0x38</span>); </span><br><span class="line">    _1602_command(<span class="number">0x0c</span>);</span><br><span class="line">    _1602_command(<span class="number">0x06</span>);</span><br><span class="line">    _1602_command(<span class="number">0x01</span>);</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _1602_command(uint com)</span><br><span class="line">&#123;</span><br><span class="line">    _1602_busy();</span><br><span class="line">    _LED_RS=<span class="number">0</span>;</span><br><span class="line">    _LED_RW=<span class="number">0</span>;</span><br><span class="line">    LED_IO=com;</span><br><span class="line">    _LED_E=<span class="number">1</span>;</span><br><span class="line">    _LED_E=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _1602_data(uint data)</span><br><span class="line">&#123;</span><br><span class="line">    _1602_busy();</span><br><span class="line">    _LED_RS=<span class="number">1</span>;</span><br><span class="line">    _LED_RW=<span class="number">0</span>;</span><br><span class="line">    LED_IO=data;</span><br><span class="line">    _LED_E=<span class="number">1</span>;</span><br><span class="line">    _LED_E=<span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">void</span> _1602_busy()    <span class="comment">//忙检测函数，判断bit7是0，允许执行；1禁止</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="keyword">unsigned</span> <span class="keyword">char</span> sta;      <span class="comment">//</span></span><br><span class="line">    LED_IO = <span class="number">0xff</span>;</span><br><span class="line">    _LED_RS = <span class="number">0</span>;</span><br><span class="line">    _LED_RW = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">do</span></span><br><span class="line">    &#123;</span><br><span class="line">        _LED_E = <span class="number">1</span>;</span><br><span class="line">        sta = LED_IO;</span><br><span class="line">        _LED_E = <span class="number">0</span>;    <span class="comment">//使能，用完就拉低，释放总线</span></span><br><span class="line">    &#125;<span class="keyword">while</span>(sta &amp; <span class="number">0x80</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">/* 中断 */</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">exter1</span><span class="params">()</span> __interrupt 1 </span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">TH0=(<span class="number">65536</span><span class="number">-50000</span>)/<span class="number">256</span>;</span><br><span class="line">TL0=(<span class="number">65536</span><span class="number">-50000</span>)%<span class="number">256</span>;</span><br><span class="line">tt++;</span><br><span class="line">  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="编译-amp-amp-烧录"><a href="#编译-amp-amp-烧录" class="headerlink" title="编译&amp;&amp;烧录"></a>编译&amp;&amp;烧录</h3><p>使用<code>sdcc -mmcs51 --code-size 8192 --model-medium --opt-code-size  51timer.c</code>编译即可</p><p>使用<code>stcgal -P stc89 -p /dev/cu.wchusbserial14330 51timer.ihx</code>烧录进单片机即可</p><h3 id="运行截图"><a href="#运行截图" class="headerlink" title="运行截图"></a>运行截图</h3><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=118988obJiVjAFxgbus0rkamxPWCYN9LByFK4kkTuuexe144X9-Nh7n9vOJpsJ3SBqH6-ddj4HePP8_Qp0fkO0kFO_6PGLUjv7N9ZlJIS4_quSn9RGquiXNUAq2kcIJPT6sB8TosapM8bpeabbtLlYagdGErjyZ1kZdcrjgK&amp;file_name=/IMG_20190830_210609.jpg" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=118988obJiVjAFxgbus0rkamxPWCYN9LByFK4kkTuuexe144X9-Nh7n9vOJpsJ3SBqH6-ddj4HePP8_Qp0fkO0kFO_6PGLUjv7N9ZlJIS4_quSn9RGquiXNUAq2kcIJPT6sB8TosapM8bpeabbtLlYagdGErjyZ1kZdcrjgK&amp;file_name=/IMG_20190830_210609.jpg"></p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=e2a1WYsDEj_rbP4SzxxSp573XfJhRUJ0VCxW9rF-4hf9BWC2-zzNefi3eK9mpLtPEN0Z6f4A90w8EpF7XWv3vy0U0zHQCf_RuOQ5BSLLP54_ENV3u17naCPl13G7m8cKJb5YPyiQ3oQcbd_-TQjLB9sNxYg2e3wHB-Qwkt-m&amp;file_name=/IMG_20190831_103808.jpg" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=e2a1WYsDEj_rbP4SzxxSp573XfJhRUJ0VCxW9rF-4hf9BWC2-zzNefi3eK9mpLtPEN0Z6f4A90w8EpF7XWv3vy0U0zHQCf_RuOQ5BSLLP54_ENV3u17naCPl13G7m8cKJb5YPyiQ3oQcbd_-TQjLB9sNxYg2e3wHB-Qwkt-m&amp;file_name=/IMG_20190831_103808.jpg"></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;学习了一段时间的单片机，觉得自己可以写点东西了，在写了无数个bug后，差不多是可以跑起来了，记录一下下吧。。。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="MCS-51" scheme="/categories/MCS-51/"/>
    
    
      <category term="单片机" scheme="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
      <category term="写bug" scheme="/tags/%E5%86%99bug/"/>
    
  </entry>
  
  <entry>
    <title>用sdcc&amp;VSCode搭建51单片机开发环境</title>
    <link href="/2019/07/25/SDCC-and-VSCode-MCS51/"/>
    <id>/2019/07/25/SDCC-and-VSCode-MCS51/</id>
    <published>2019-07-25T11:44:34.000Z</published>
    <updated>2019-08-30T12:51:26.907Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>学习了一段时间的单片机，虽然Keil搞单片机是最常见的方案，但总是感觉Keil用着很不习惯<br>在翻了无数次车之后，终于在跑起来了，特此记录一下下吧。。。。</p></blockquote><a id="more"></a><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>众所周知，Keil下搞单片机是最好的选择，但是用起来的体验么。。。。。<br><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=6784oJECJEUGaib8_M1Pnp_5kFIScKoCHh9-zlL1LAJmm-wiCrGc1QIscFvUPFz10TrLioqgTBpPO8Tt0VOlX_vm0Hziz9qWOl1iOSlDqD22we36rRHKl8AY7zOppH7Dy4eTzk0q78q7xQE81w&amp;file_name=/1564062406306.jpeg" alt="ll"><br>凡事就是图一个折腾。于是乎，Let’s Go！</p><h4 id="要进行的工作"><a href="#要进行的工作" class="headerlink" title="要进行的工作"></a>要进行的工作</h4><ol><li>安装sdcc   </li><li>安装Visual Studio Code   </li><li>安装烧录程序   </li><li>安装ttl下载器的驱动</li></ol><h4 id="sdcc简介"><a href="#sdcc简介" class="headerlink" title="sdcc简介"></a>sdcc简介</h4><p><a href="http://sdcc.sourceforge.net/" target="_blank" rel="noopener">sdcc (Small Device C Compiler) </a> 是一个应用于单片机的一个交叉编译器，其官网上的解释是这样的</p><blockquote><p>SDCC is a retargettable, optimizing Standard C (ANSI C89, ISO C99, ISO C11) compiler suite that targets the Intel MCS51 based microprocessors (8031, 8032, 8051, 8052, etc.), Maxim (formerly Dallas) DS80C390 variants, Freescale (formerly Motorola) HC08 based (hc08, s08), Zilog Z80 based MCUs (z80, z180, gbz80, Rabbit 2000/3000, Rabbit 3000A, TLCS-90), Padauk (pdk14, pdk15) and STMicroelectronics STM8. Work is in progress on supporting the Padauk (pdk13), Microchip PIC16 and PIC18 targets. It can be retargeted for other microprocessors.</p></blockquote><p><del>为什么不放中文，因为英语水平太差</del></p><p><strong>需要注意的是，sdcc与Keil的语法是有一些不相同的地方的</strong>，下面是一些不相同的地方供以参考</p><table><thead><tr><th>SDCC</th><th>Keil</th></tr></thead><tbody><tr><td><strong>sbit   </strong>at 0x94 a</td><td>sbit a=P1^4</td></tr><tr><td>0x80</td><td>P0^0</td></tr><tr><td>0x90</td><td>P1^0</td></tr><tr><td>0xA0</td><td>P2^0</td></tr><tr><td>0xB0</td><td>P3^0</td></tr><tr><td>P1_1</td><td>P1^1</td></tr><tr><td>__interrupt</td><td>interrupt</td></tr></tbody></table><p><del>遇事不决双下划线</del></p><h2 id="正式步骤"><a href="#正式步骤" class="headerlink" title="正式步骤"></a>正式步骤</h2><h3 id="MacOS"><a href="#MacOS" class="headerlink" title="MacOS"></a>MacOS</h3><h4 id="安装sdcc"><a href="#安装sdcc" class="headerlink" title="安装sdcc"></a>安装sdcc</h4><p>MacOS下安装sdcc是非常简单的，使用brew一键安装就ok 了</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">/usr/bin/ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;      #安装brew</span><br><span class="line">brew install sdcc   #安装sdcc</span><br></pre></td></tr></table></figure><p>编译时，只需要使用<code>sdcc sourcefile.c</code>即可完成编译   </p><h4 id="安装配置VSCode"><a href="#安装配置VSCode" class="headerlink" title="安装配置VSCode"></a>安装配置VSCode</h4><p>安装完了编译环境，自然也需要一个代码编辑器。在这里，我选用了<code>Visual Studio Code</code>来作为编辑器</p><ol><li>进入<a href="https://code.visualstudio.com/" target="_blank" rel="noopener">官网</a>，下载并安装   </li></ol><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=a8bct-6J20tEft5b01PBGgXutELBUbdiiFZ64FEI8jLFG6aKJuXxlK9rc4BbPUl8T8rdvA3t206mjc5450xvRnIT9du0D6hIYhsakCER2CUQFzn29PZbQ4-1h8l6puDliMsRgF7Cw3NPqIzZqpAkFwzLAyhl&amp;file_name=/QQ20190725-205707.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=a8bct-6J20tEft5b01PBGgXutELBUbdiiFZ64FEI8jLFG6aKJuXxlK9rc4BbPUl8T8rdvA3t206mjc5450xvRnIT9du0D6hIYhsakCER2CUQFzn29PZbQ4-1h8l6puDliMsRgF7Cw3NPqIzZqpAkFwzLAyhl&amp;file_name=/QQ20190725-205707.png"></p><ol start="2"><li>安装完成之后添加<code>C/C++</code>扩展</li></ol><ol start="3"><li>按下<code>Shift+Command+P</code>,选择<code>C/C++:编辑配置</code>,在<code>includePath</code>添加sdcc的头文件地址</li></ol><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"configurations"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"Mac"</span>,</span><br><span class="line">            <span class="attr">"includePath"</span>: [</span><br><span class="line">                <span class="string">"$&#123;workspaceFolder&#125; /**"</span>,</span><br><span class="line">                <span class="string">"$&#123;workspaceFolder&#125; /include"</span>,</span><br><span class="line">                <span class="string">"/usr/local/Cellar/sdcc/3.9.0/share/sdcc/include/mcs51"</span>,</span><br><span class="line">                <span class="string">"/usr/local/Cellar/sdcc/3.9.0/share/sdcc/include/**"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"defines"</span>: [],</span><br><span class="line">            <span class="attr">"macFrameworkPath"</span>: [</span><br><span class="line">                <span class="string">"/Users/fzx172/Xcode.app/Contents/Developer/Platforms/MacOSX.platform/Developer/SDKs/MacOSX10.11.sdk/System/Library/Frameworks"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"compilerPath"</span>: <span class="string">"/usr/bin/clang"</span>,</span><br><span class="line">            <span class="attr">"cStandard"</span>: <span class="string">"c11"</span>,</span><br><span class="line">            <span class="attr">"cppStandard"</span>: <span class="string">"c++17"</span>,</span><br><span class="line">            <span class="attr">"intelliSenseMode"</span>: <span class="string">"clang-x64"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=c0874AMQVJ_io4VP-CdM9rzO6gGggUgRvzGL8oVqaEZwlN0P4ovpmPk_qxQrus0Q86dYb3SSIFTSO2bFaKvIy5lOpc7f_kH35lGJTSkNyzJ275T7wNH9aBn4oJHr-KjV8y1n7aqyqfz9ld45_M1zMJF-Ql_H&amp;file_name=/QQ20190726-081616.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=c0874AMQVJ_io4VP-CdM9rzO6gGggUgRvzGL8oVqaEZwlN0P4ovpmPk_qxQrus0Q86dYb3SSIFTSO2bFaKvIy5lOpc7f_kH35lGJTSkNyzJ275T7wNH9aBn4oJHr-KjV8y1n7aqyqfz9ld45_M1zMJF-Ql_H&amp;file_name=/QQ20190726-081616.png"></p><h4 id="安装Stcgal"><a href="#安装Stcgal" class="headerlink" title="安装Stcgal"></a>安装Stcgal</h4><p>编辑器和编译器都解决了，下面应该解决下载程序</p><ol><li>安装Python3   </li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">brew insall python3</span><br></pre></td></tr></table></figure><ol start="2"><li>修改python3为系统默认版本</li></ol><p>打开<code>.bash_profile</code>，添加以下内容</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python_switch</span></span><br><span class="line"><span class="keyword">function</span> python2_switch &#123;</span><br><span class="line">    sudo unlink /usr/bin/python</span><br><span class="line">    sudo ln -s /System/Library/Frameworks/Python.framework/Versions/2.7/bin/python /usr/bin/python</span><br><span class="line">    chmod a+x /usr/bin/python</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">"Python2已部署"</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">function</span> python3_switch &#123;</span><br><span class="line">    sudo unlink /usr/bin/python</span><br><span class="line">    sudo ln -s /Library/Frameworks/Python.framework/Versions/3.7/bin/python3 /usr/bin/python</span><br><span class="line">    chmod a+x /usr/bin/python</span><br><span class="line">    <span class="built_in">echo</span> -e <span class="string">"Python3已部署"</span></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=dee8ZMj6Uv-5k7V4TpMJLiZaMhZOk80B90ug26dzQGmcLFZnWnt03TtmdHThg3pZ7qqAyU6S_Qyg67EfiDLbHI2TLH1Wj_Jqt1my31a2u68WSO_fRWWB_I2_vHi6tvJtRtiUPEWpM2fRO_W_2PMHjsX5zRrg&amp;file_name=/QQ20190726-083455.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=dee8ZMj6Uv-5k7V4TpMJLiZaMhZOk80B90ug26dzQGmcLFZnWnt03TtmdHThg3pZ7qqAyU6S_Qyg67EfiDLbHI2TLH1Wj_Jqt1my31a2u68WSO_fRWWB_I2_vHi6tvJtRtiUPEWpM2fRO_W_2PMHjsX5zRrg&amp;file_name=/QQ20190726-083455.png"></p><p>保存后执行<code>source ~/.bash_profile</code>，即可快速进行python版本切换</p><ol start="3"><li>安装stcgal</li></ol><p>执行<code>pip install stcgal</code>即可安装</p><h4 id="安装ttl下载器的驱动"><a href="#安装ttl下载器的驱动" class="headerlink" title="安装ttl下载器的驱动"></a>安装ttl下载器的驱动</h4><p><a href="http://www.prolific.com.tw/us/showproduct.aspx?p_id=229&amp;pcid=41" target="_blank" rel="noopener">PL2303</a>   </p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=29a6Q9t1uQQlHM0ZXbDGP4qozgXPrvlP3KwTFVmUoJ-HreaYrguilkEEGEPnTBPIg1NBpdWeC2rL35vkDU1b0ZsTWpKI1IexrYs-ygdhs8Ee7Sq3zVRujF9Q2Q1UiHraV7hk0Y_1_SyM8Kaz6eiCb0wzILM6&amp;file_name=/QQ20190725-212733.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=29a6Q9t1uQQlHM0ZXbDGP4qozgXPrvlP3KwTFVmUoJ-HreaYrguilkEEGEPnTBPIg1NBpdWeC2rL35vkDU1b0ZsTWpKI1IexrYs-ygdhs8Ee7Sq3zVRujF9Q2Q1UiHraV7hk0Y_1_SyM8Kaz6eiCb0wzILM6&amp;file_name=/QQ20190725-212733.png"></p><p><a href="http://www.wch.cn/download/CH341SER_MAC_ZIP.html" target="_blank" rel="noopener">CH340</a></p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=08af0yXzI5J7f2Lh4h6bR6DGGBmeDZT67NJiSJFX3-848sEOK6i2jIk_1xKXRaaPM_MHfqroYM0EMUDgzZ7G9zX71rnLNmC-ltE7Md4TkuA2ioiAUmVJ2D-TzyKNJlQ1yA2jCWdVYd8QMYpG5eVWJx2JNO5t&amp;file_name=/QQ20190725-215326.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=08af0yXzI5J7f2Lh4h6bR6DGGBmeDZT67NJiSJFX3-848sEOK6i2jIk_1xKXRaaPM_MHfqroYM0EMUDgzZ7G9zX71rnLNmC-ltE7Md4TkuA2ioiAUmVJ2D-TzyKNJlQ1yA2jCWdVYd8QMYpG5eVWJx2JNO5t&amp;file_name=/QQ20190725-215326.png"></p><p>到此，macOS的51开发环境便搭建完毕</p><h3 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h3><h4 id="安装sdcc-1"><a href="#安装sdcc-1" class="headerlink" title="安装sdcc"></a>安装sdcc</h4><p>Windwos下可以不适用包管理器，直接前往<a href="https://sourceforge.net/projects/sdcc/files/sdcc-win64/" target="_blank" rel="noopener">SourceForge</a>下载安装即可</p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=857bcePze5-eDwMtJI_DK7bKw-niDPgcxOeCBFl9y2RXVphG_ivVSFg2FJLs_xIG-VvVNj16lIunW7kZ4CF3Q7ssm0fw-uTR4uO4eYNvuLsi3VwZXjok2gSBXx-WxSr61QFGRVxhsW-nbCJ6_BPKRCdagA8W&amp;file_name=/QQ20190814-175410.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=857bcePze5-eDwMtJI_DK7bKw-niDPgcxOeCBFl9y2RXVphG_ivVSFg2FJLs_xIG-VvVNj16lIunW7kZ4CF3Q7ssm0fw-uTR4uO4eYNvuLsi3VwZXjok2gSBXx-WxSr61QFGRVxhsW-nbCJ6_BPKRCdagA8W&amp;file_name=/QQ20190814-175410.png"></p><h4 id="安装VSCode"><a href="#安装VSCode" class="headerlink" title="安装VSCode"></a>安装VSCode</h4><ol><li><p>进入<a href="https://code.visualstudio.com/" target="_blank" rel="noopener">官网</a>，下载并安装即可   </p></li><li><p>安装完成之后添加<code>C/C++</code>扩展  </p></li><li><p>添加头文件</p></li></ol><p>按下<code>Shift+Ctrl+P</code>,选择<code>C/C++:编辑配置</code>,在<code>includePath</code>添加sdcc的头文件地址</p><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"configurations"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">            <span class="attr">"name"</span>: <span class="string">"Win32"</span>,</span><br><span class="line">            <span class="attr">"includePath"</span>: [</span><br><span class="line">                <span class="string">"$&#123;workspaceFolder&#125;/**"</span>,</span><br><span class="line">                <span class="string">"C:/Program Files/SDCC/include"</span>,</span><br><span class="line">                <span class="string">"C:/Program Files/SDCC/include/mcs51"</span>,</span><br><span class="line">                <span class="string">"$&#123;workspaceFolder&#125;/include"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"defines"</span>: [</span><br><span class="line">                <span class="string">"_DEBUG"</span>,</span><br><span class="line">                <span class="string">"UNICODE"</span>,</span><br><span class="line">                <span class="string">"_UNICODE"</span></span><br><span class="line">            ],</span><br><span class="line">            <span class="attr">"intelliSenseMode"</span>: <span class="string">"msvc-x64"</span></span><br><span class="line">        &#125;</span><br><span class="line">    ],</span><br><span class="line">    <span class="attr">"version"</span>: <span class="number">4</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=ba446KW22Gaq6qErA8AmpIUMZmo8WJ_iEacws9jhvPssxwECpPjTE7vpGc3FuhDDO6gZPmklLVyYlyARn1XWVDU-QZ6IUoSdgmWhRvtYmoXRw1VEqVj0JfwQ2TTVHz9zaNPriUl9G2LkaY-fVkoEILXWaYse&amp;file_name=/QQ20190814-181851.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=ba446KW22Gaq6qErA8AmpIUMZmo8WJ_iEacws9jhvPssxwECpPjTE7vpGc3FuhDDO6gZPmklLVyYlyARn1XWVDU-QZ6IUoSdgmWhRvtYmoXRw1VEqVj0JfwQ2TTVHz9zaNPriUl9G2LkaY-fVkoEILXWaYse&amp;file_name=/QQ20190814-181851.png"></p><h4 id="下载烧录程序以及下载器驱动"><a href="#下载烧录程序以及下载器驱动" class="headerlink" title="下载烧录程序以及下载器驱动"></a>下载烧录程序以及下载器驱动</h4><p>windows下<a href="http://www.stcmcu.com/index.htm" target="_blank" rel="noopener">官网</a>有提供烧录工具和驱动，所以直接下载即可   </p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=06451eJroZsL_xnd5cduDfD-60078Rh_Fe-jGSC0_2epm4sOliRMSn9MRCpLr3FSzQvTzYIB7UdqpE-8HQLTADG3-LTrKiGQOQ0hUKq1ezFtk-0IYy-s6tplrAFk-R6yrn-pEpiwhXUzNac1Q6lLYeAUlHxZzOYg0VerAPqMte3jzstGlzpNecs&amp;file_name=/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-08-14%20%E4%B8%8B%E5%8D%886.56.21.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=06451eJroZsL_xnd5cduDfD-60078Rh_Fe-jGSC0_2epm4sOliRMSn9MRCpLr3FSzQvTzYIB7UdqpE-8HQLTADG3-LTrKiGQOQ0hUKq1ezFtk-0IYy-s6tplrAFk-R6yrn-pEpiwhXUzNac1Q6lLYeAUlHxZzOYg0VerAPqMte3jzstGlzpNecs&amp;file_name=/%E5%B1%8F%E5%B9%95%E5%BF%AB%E7%85%A7%202019-08-14%20%E4%B8%8B%E5%8D%886.56.21.png"></p><p>这样，Windows下的开发环境便搭建好了，Enjoy！<img class="emoji aru" src="https://cdn.jsdelivr.net/gh/xaoxuu/volantis@1.0/img/aru/151.png"></p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>折腾了半天，终于将环境折腾好了，感觉一切都好，就是头发少   </p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=0997f_DQPE9FeLzMfupFTFj8eCn_-fmOaY8sU5ggPl_UiIkifGM8EDwuY6eO1WNP0oqyBoXd7e0QIL3UYYn9TZ0o1dg79aOHyDTSpfpHIyvR834Jf32LP42AbVGV0i-6GmmhKA3kBw5kBIS9KUd9GQOOhc7AA8nLhxOy44bNfA&amp;file_name=/0902C8FE5E204783AAEA2A04A28B43B0.jpg" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=0997f_DQPE9FeLzMfupFTFj8eCn_-fmOaY8sU5ggPl_UiIkifGM8EDwuY6eO1WNP0oqyBoXd7e0QIL3UYYn9TZ0o1dg79aOHyDTSpfpHIyvR834Jf32LP42AbVGV0i-6GmmhKA3kBw5kBIS9KUd9GQOOhc7AA8nLhxOy44bNfA&amp;file_name=/0902C8FE5E204783AAEA2A04A28B43B0.jpg"></p><p>我爱单片机，单片机是我快乐</p><p><del>可不可以的话扫一下右边的码支持一下，我会挖更多的坑的</del></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;学习了一段时间的单片机，虽然Keil搞单片机是最常见的方案，但总是感觉Keil用着很不习惯&lt;br&gt;在翻了无数次车之后，终于在跑起来了，特此记录一下下吧。。。。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="MCS-51" scheme="/categories/MCS-51/"/>
    
    
      <category term="单片机" scheme="/tags/%E5%8D%95%E7%89%87%E6%9C%BA/"/>
    
  </entry>
  
  <entry>
    <title>J1900软路由折腾记</title>
    <link href="/2019/05/31/J1900-PVE-RouterOS-Installation/"/>
    <id>/2019/05/31/J1900-PVE-RouterOS-Installation/</id>
    <published>2019-05-31T10:56:16.000Z</published>
    <updated>2019-06-21T03:13:56.346Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>夏天到了，突然发现我的小米路由器3好像慢了很多。但是我的钱包却告诉我它还很流畅<br>于是乎我看了一眼桌子上的J1900……  <del>J1900:你不要过来啊</del></p></blockquote><a id="more"></a><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>  众所周知，北方是一个没有春秋的地方。众所又周知，学校的建设工作总是会在你在校的时候发出通知，却在你快要离校的时候开始建设，什么时候你离开校园了，学校也就建设好了。这两者加在一起，并不会是双倍的快乐。<del>为什么呢，明明是我先的</del></p><p>  吐槽归吐槽，夏天到了。以发烧著称的小米路由3逐渐开始发高烧。并出现了断流，网速不稳一系列并发症。身为医学狗的我，自然就要修理一番。正好，前段时间刚把J1900小主机弄起来，那为什么不直接用PVE弄一个软路由，然后桥接一下。再搞一下多拨什么的岂不是美滋滋。<del>这回就是双倍的快乐了</del></p><h4 id="前期的准备以及工具"><a href="#前期的准备以及工具" class="headerlink" title="前期的准备以及工具"></a>前期的准备以及工具</h4><ol><li>一张PCI千兆网卡(我的主板只有一个网线口，只能再购买一块)</li><li>4G优盘一枚</li><li>可以正常使用apt的网络</li><li>一台可以使用ssh的电脑</li><li>J1900小主板</li></ol><h4 id="要进行的操作"><a href="#要进行的操作" class="headerlink" title="要进行的操作"></a>要进行的操作</h4><ol><li>用pve安装一个软路由系统</li><li>编译mentohust进行校园网的拨号</li><li>与小米路由器3桥接</li><li>进行校园网多拨</li><li>添加路由器定时任务，防止掉线</li></ol><h2 id="正式步骤"><a href="#正式步骤" class="headerlink" title="正式步骤"></a>正式步骤</h2><h3 id="软路由系统安装"><a href="#软路由系统安装" class="headerlink" title="软路由系统安装"></a>软路由系统安装</h3><p>提到第三方的路由系统，首先想到的就是openwrt啦，在这里，我选择了<a href="https://x-wrt.com/" target="_blank" rel="noopener">X-WRT</a>作为软路由的系统</p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=2cfdSzPXzd9cjFYB96u94X6dJGDiHR3G4oHesmH3qbGJga0sh5_yEb0fqVZPvRbdSFWfN6qcBBlfXUJST_gwRGt6m8sXhKEm4-W_LTAYmDTs1vGfcEIVU-Sj8fKsJ1SIy0iq53jmwEdOKaKLXjXeGTOjgg&amp;file_name=/QQ20190617-212203.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=af71HrEDRr_brrANGgy0kCfKdMAfd9zkJtiidhqeDFeRNNt9ZPeuqSZql6dec4xkJnjEA51WDUb5RSUcGy5v9-dVkWLA2qfIoIk5hnA9T0C7-VM6ZEIt0IKXK08oJ78joQGnd2p_PfjzHB5Gv3OLzsumqA&amp;file_name=/QQ20190606-162015.png"></p><h4 id="下载系统镜像并解压"><a href="#下载系统镜像并解压" class="headerlink" title="下载系统镜像并解压"></a>下载系统镜像并解压</h4><p>在<a href="https://downloads.x-wrt.com/rom/" target="_blank" rel="noopener">X-WRT的下载界面里</a>选择<code>x86 64bits (MBR dos)</code>下载后并解压文件</p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=af71HrEDRr_brrANGgy0kCfKdMAfd9zkJtiidhqeDFeRNNt9ZPeuqSZql6dec4xkJnjEA51WDUb5RSUcGy5v9-dVkWLA2qfIoIk5hnA9T0C7-VM6ZEIt0IKXK08oJ78joQGnd2p_PfjzHB5Gv3OLzsumqA&amp;file_name=/QQ20190606-162015.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=af71HrEDRr_brrANGgy0kCfKdMAfd9zkJtiidhqeDFeRNNt9ZPeuqSZql6dec4xkJnjEA51WDUb5RSUcGy5v9-dVkWLA2qfIoIk5hnA9T0C7-VM6ZEIt0IKXK08oJ78joQGnd2p_PfjzHB5Gv3OLzsumqA&amp;file_name=/QQ20190606-162015.png"></p><h4 id="将镜像写入到优盘内"><a href="#将镜像写入到优盘内" class="headerlink" title="将镜像写入到优盘内"></a>将镜像写入到优盘内</h4><blockquote><p><strong>注意，写入镜像会清除优盘的所有数据，请注意备份文件</strong>      </p></blockquote><h5 id="Windows"><a href="#Windows" class="headerlink" title="Windows"></a>Windows</h5><ol><li>下载<a href="https://etcher.io/" target="_blank" rel="noopener">etcher</a>并安装   </li><li>插入优盘，打开etcher，选择下载好的镜像并选择优盘写入   </li></ol><p><img src="https://img.vim-cn.com/85/c0b7189b77de5da14811c3e6b3085170cce083.png" alt="etcher">   </p><h5 id="Linux-amp-amp-Mac"><a href="#Linux-amp-amp-Mac" class="headerlink" title="Linux &amp;&amp; Mac"></a>Linux &amp;&amp; Mac</h5><p>打开终端，输入以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">diskutil list <span class="comment">#查看电脑里优盘的路径，比如我的是disk4</span></span><br><span class="line">dd <span class="keyword">if</span>=/Users/fzx172/Downloads/x-wrt-5.0-b201905172119-x86-64-combined-ext4.iso of=/dev/disk4  <span class="comment">#写入镜像</span></span><br></pre></td></tr></table></figure><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=b1cd0BfU-rrzb2LDww4vEfa5ChmYQWn4GY5CedXeu8wSq-tgQd8iBmX0CCe3IC3kyDI4g8mL7mAjQdfj8tes_XRhHO7abamSxBxBYPZ2lhG0egZE0Tp4Xs3MiLEYwC4bYAFY29EcdCUsr9BDIcpt2jiMGQ&amp;file_name=/QQ20190617-212446.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=b1cd0BfU-rrzb2LDww4vEfa5ChmYQWn4GY5CedXeu8wSq-tgQd8iBmX0CCe3IC3kyDI4g8mL7mAjQdfj8tes_XRhHO7abamSxBxBYPZ2lhG0egZE0Tp4Xs3MiLEYwC4bYAFY29EcdCUsr9BDIcpt2jiMGQ&amp;file_name=/QQ20190617-212446.png"></p><blockquote><p>镜像写入成功后可能会提示无法访问，忽略即可<br><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=179eeCJaamwnxBtezEMaPWqCLJorsZ4hrfHlsy2DmwcmZVGWWnema4mCyMBWgzJ3PBE7mic4A25qcyxrCYcUqFtH0wL3AUNExknvwceV7SjE1L8wLDDtAXYTX59YCbAlfVEc7d5LVLSWoUz4Vgww17uieA&amp;file_name=/QQ20190617-214204.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=179eeCJaamwnxBtezEMaPWqCLJorsZ4hrfHlsy2DmwcmZVGWWnema4mCyMBWgzJ3PBE7mic4A25qcyxrCYcUqFtH0wL3AUNExknvwceV7SjE1L8wLDDtAXYTX59YCbAlfVEc7d5LVLSWoUz4Vgww17uieA&amp;file_name=/QQ20190617-214204.png"></p></blockquote><h4 id="PVE虚拟机的创建以及启动"><a href="#PVE虚拟机的创建以及启动" class="headerlink" title="PVE虚拟机的创建以及启动"></a>PVE虚拟机的创建以及启动</h4><ol><li>打开PVE的后台，选择创建虚拟机，具体配置的话视情况而定即可</li></ol><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=ea6fgd9V90vMNcb9zfkcg5xYXRP4b705vZUDa8x-O2Hm-JCu58N5By0Shqg3g03zulKljMWoJ4D3sa7W_kJ16XawS6U-_aWY-poX1bg0OIorIw9CneMEuOjyssKRZBfH6mFCLwhEBKLMI5wD9E820GePBQ&amp;file_name=/QQ20190618-173829.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=ea6fgd9V90vMNcb9zfkcg5xYXRP4b705vZUDa8x-O2Hm-JCu58N5By0Shqg3g03zulKljMWoJ4D3sa7W_kJ16XawS6U-_aWY-poX1bg0OIorIw9CneMEuOjyssKRZBfH6mFCLwhEBKLMI5wD9E820GePBQ&amp;file_name=/QQ20190618-173829.png"></p><ol start="2"><li>创建完成，将优盘插到主板上，选择点击<code>添加</code>&gt;<code>USB设备</code>，并选择你的优盘</li></ol><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=5011mchGoNimO5C2pLROracNwKBd_ZTC__bXhfarRz6G7_X-L5T2v7Dshi-O9DC00yLPiHHQfzHGa0Hbf8oqenRk49s3K_CmaShUvMtj6ZuiEC0Z4B4GR2eZQ-sUDFLzMsOlfU8Ehn3RqWwjNMp9qkSLig&amp;file_name=/QQ20190618-174253.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=5011mchGoNimO5C2pLROracNwKBd_ZTC__bXhfarRz6G7_X-L5T2v7Dshi-O9DC00yLPiHHQfzHGa0Hbf8oqenRk49s3K_CmaShUvMtj6ZuiEC0Z4B4GR2eZQ-sUDFLzMsOlfU8Ehn3RqWwjNMp9qkSLig&amp;file_name=/QQ20190618-174253.png"></p><ol start="3"><li><p>添加成功后，启动虚拟机，按住ESC键直至出现引导界面</p></li><li><p>选择你的优盘作为启动设备，然后稍等片刻即可进入系统</p></li></ol><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=b6fdlkmpj6lFMsaXH_Yc02ZiAkotlojZr9IOlVCDroFleiwD0blcZ131Tv9lyGbA0JDqKR8mZWptp4f6RV7ZoWg1vrcNLBZ2D7vCd_M3Hl1dfuD5gVes1V-RmvsvezUakMv6szZSqVnmwlCQcwv7y5DPSw&amp;file_name=/QQ20190620-090019.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=b6fdlkmpj6lFMsaXH_Yc02ZiAkotlojZr9IOlVCDroFleiwD0blcZ131Tv9lyGbA0JDqKR8mZWptp4f6RV7ZoWg1vrcNLBZ2D7vCd_M3Hl1dfuD5gVes1V-RmvsvezUakMv6szZSqVnmwlCQcwv7y5DPSw&amp;file_name=/QQ20190620-090019.png"></p><h4 id="将镜像写入系统磁盘中"><a href="#将镜像写入系统磁盘中" class="headerlink" title="将镜像写入系统磁盘中"></a>将镜像写入系统磁盘中</h4><p>路由器的默认账户和密码分别是<code>root</code>和<code>admin</code>，登陆后执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l <span class="comment">#查看系统的磁盘，比如，我创建的磁盘为/dev/sda,U盘为/dev/sdb</span></span><br><span class="line">dd <span class="keyword">if</span>=/dev/sdb of=/dev/sda   <span class="comment">#将镜像写入</span></span><br></pre></td></tr></table></figure><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=d5e1ht2678_sS11xitqRqUoaAJJhTfMx9d843BCJqgItuXLIbpWXPsmGyrGLr5SmOZNJMxsmtCs55tei2KX65VMouL-01OdjR2NnVz01a_P2TjXzhsAefNegWEEK4xD0KRYcYQbn5B7hp6kX-uNck4daow&amp;file_name=/QQ20190620-091521.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=d5e1ht2678_sS11xitqRqUoaAJJhTfMx9d843BCJqgItuXLIbpWXPsmGyrGLr5SmOZNJMxsmtCs55tei2KX65VMouL-01OdjR2NnVz01a_P2TjXzhsAefNegWEEK4xD0KRYcYQbn5B7hp6kX-uNck4daow&amp;file_name=/QQ20190620-091521.png"></p><p>此时重启拔掉优盘，路由系统便可以从硬盘启动</p><h3 id="编译mentohust进行校园网的拨号"><a href="#编译mentohust进行校园网的拨号" class="headerlink" title="编译mentohust进行校园网的拨号"></a>编译mentohust进行校园网的拨号</h3><h4 id="硬件连接"><a href="#硬件连接" class="headerlink" title="硬件连接"></a>硬件连接</h4><blockquote><p>由于我的主机只有一个网口，于是乎我单独购买了一块PCI千兆网卡用来连接校园网。</p></blockquote><p>关闭虚拟机，进入虚拟机的硬件设置，添加一块网卡，桥接设备选择PCI网卡</p><p>启动虚拟机，发现系统可以识别到网络，但是无法正确连接，此时我们则需要编译mentohust来进行校园网拨号</p><h4 id="编译mentohust"><a href="#编译mentohust" class="headerlink" title="编译mentohust"></a>编译mentohust</h4><blockquote><p>一开始我尝试使用macOS直接进行编译，然而经历了无数次尝(翻)试(车)之后,我跑路了。。。。。<del>然而并没有</del><br>后来发现了一个神奇的东西叫做docker，然后用docker编译成功了<del>docker一时爽，一直docker一直爽</del></p></blockquote><h5 id="下载并安装docker"><a href="#下载并安装docker" class="headerlink" title="下载并安装docker"></a>下载并安装docker</h5><ol><li><p>前往<a href="https://www.docker.com/" target="_blank" rel="noopener">docker</a>官网下载docker的安装包安装并打开</p></li><li><p>打开终端，依次执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker pull openwrtorg/packages-cci <span class="comment">#拉取镜像</span></span><br><span class="line">docker images <span class="comment">#查看当前镜像的ID ，比如我的是472dadf87bcc</span></span><br><span class="line">docker run --name openwrt -itd 472dadf87bcc /bin/bash <span class="comment">#创建一个名为openwrt的容器</span></span><br><span class="line">docker <span class="built_in">exec</span> -it openwrt /bin/bash <span class="comment">#为当前容器分配一个伪终端</span></span><br></pre></td></tr></table></figure></li></ol><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=7c347foNabDP3D4eiYCtnIQagNhuwJElRfD-HvBydTv1nN3l8xlj1HR1p_hAuYQKraVlJ2VgmRTrkG0Fk-GflOuDzyEzqVj7zxBmo_H0zgYDQCcM21RScc3WkXAzrTPV018aBGOgD2A-UpoiuGqHZs5I2Q&amp;file_name=/QQ20190617-230606.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=7c347foNabDP3D4eiYCtnIQagNhuwJElRfD-HvBydTv1nN3l8xlj1HR1p_hAuYQKraVlJ2VgmRTrkG0Fk-GflOuDzyEzqVj7zxBmo_H0zgYDQCcM21RScc3WkXAzrTPV018aBGOgD2A-UpoiuGqHZs5I2Q&amp;file_name=/QQ20190617-230606.png"></p><p>  此时，编译的环境就ok了，下面我们就可以编译mentohust了</p><h5 id="编译mentohust-1"><a href="#编译mentohust-1" class="headerlink" title="编译mentohust"></a>编译mentohust</h5><blockquote><p>教程和源代码，我参考了<a href="https://github.com/KyleRicardo/MentoHUST-OpenWrt-ipk" target="_blank" rel="noopener">这位大佬</a>的教程,将自己的膝盖奉上</p></blockquote><ol><li><p>下载并更新openwrt的源代码</p><p><del>下载代码的时候可能会相当慢，自备工具</del></p><p>在刚才的伪终端中，依次执行以下命令</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">git <span class="built_in">clone</span> https://git.openwrt.org/openwrt/openwrt.git <span class="comment">#下载源码</span></span><br><span class="line"><span class="built_in">cd</span> openwrt/</span><br><span class="line">./scripts/feeds update</span><br><span class="line">./scripts/feeds install -a </span><br><span class="line">git <span class="built_in">clone</span> https://github.com/KyleRicardo/MentoHUST-OpenWrt-ipk.git package/mentohust <span class="comment">##下载mentohust源码</span></span><br><span class="line">make menuconfig  <span class="comment"># 配置make文件</span></span><br></pre></td></tr></table></figure><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=0b3ckgNiqHSLzkOPrGR7LtvNq_9QBva43Llbb7D6IZ8YEXfuzFu9OnXgeB-2ZXVsosPMw7nXvplIR-MF-J5g1-3eheEHM-AstouHUPY42IvMKyKjs-QjwlVnMB-LNDlbWlgdR8J3qz6Q-5vQKvfSSvdipw&amp;file_name=/QQ20190618-110006.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=0b3ckgNiqHSLzkOPrGR7LtvNq_9QBva43Llbb7D6IZ8YEXfuzFu9OnXgeB-2ZXVsosPMw7nXvplIR-MF-J5g1-3eheEHM-AstouHUPY42IvMKyKjs-QjwlVnMB-LNDlbWlgdR8J3qz6Q-5vQKvfSSvdipw&amp;file_name=/QQ20190618-110006.png"></p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=ab44enzPpayltcIzdK07bGZvbCWHo_s6B5hP_6zhrIO271EFvkEvIHYU_w3N1yEYu3HicvoHn0OmuhG_7ITLl16cOGk-SwpnYT9pgQkB7Sxcgh6NE2_XHv9FS2xU4x2MrjJ5ECjio3V4f1_Oj9xJoHSbVQ&amp;file_name=/QQ20190618-110603.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=ab44enzPpayltcIzdK07bGZvbCWHo_s6B5hP_6zhrIO271EFvkEvIHYU_w3N1yEYu3HicvoHn0OmuhG_7ITLl16cOGk-SwpnYT9pgQkB7Sxcgh6NE2_XHv9FS2xU4x2MrjJ5ECjio3V4f1_Oj9xJoHSbVQ&amp;file_name=/QQ20190618-110603.png"></p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=16dc9-xzCQsA2VHjs8yivYZM9BCXmtUU460lhhVj5AraJZMnGpckhkvAip_IR5MuEQjLLX_h2prOnYf7psUZ1vQPdclTUQ1lWWZDaaPXAYtKLUIiMFdnI13WAiGU6bdGNFs34jTD5dPbiQsVOi8Vn67Hcw&amp;file_name=/QQ20190618-110716.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=16dc9-xzCQsA2VHjs8yivYZM9BCXmtUU460lhhVj5AraJZMnGpckhkvAip_IR5MuEQjLLX_h2prOnYf7psUZ1vQPdclTUQ1lWWZDaaPXAYtKLUIiMFdnI13WAiGU6bdGNFs34jTD5dPbiQsVOi8Vn67Hcw&amp;file_name=/QQ20190618-110716.png"></p><ol start="2"><li>配置make文件</li></ol><p>在伪终端中，依次选择以下内容 </p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Target System  &gt; x86    </span><br><span class="line">Subtarget &gt; x86_64  </span><br><span class="line">Network &gt; Ruijie &gt; mentohust ##使用空格键确定，即以模块方式编译</span><br></pre></td></tr></table></figure><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=932bbubWu_-H-E2IlJeyObgniUJgGa_kvda0fIdEmDdIL5zTBbEh0gPoit8mXaqv1kQrtgjurcwVDEFVv4-Klm-Btp1CA5MuUTaLfWStoE8h7ZhNeYUwA7IbiRGxACK583xF-OXgBBV8y6Pz2wpE67rbgw&amp;file_name=/QQ20190618-110858.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=932bbubWu_-H-E2IlJeyObgniUJgGa_kvda0fIdEmDdIL5zTBbEh0gPoit8mXaqv1kQrtgjurcwVDEFVv4-Klm-Btp1CA5MuUTaLfWStoE8h7ZhNeYUwA7IbiRGxACK583xF-OXgBBV8y6Pz2wpE67rbgw&amp;file_name=/QQ20190618-110858.png"></p><p>按TAB键保存，然后退出即可</p><ol start="3"><li>编译文件</li></ol><p>保存make文件之后，依次执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">make tools/install V=s </span><br><span class="line">make toolchain/install V=s</span><br><span class="line">make package/mentohust/compile V=s</span><br></pre></td></tr></table></figure><p>编译时间可能会比较长，请耐心等待</p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=f9ec6URvn1BgKrPQnjbKPAr5HN2sxfoxtBFJhU4tpifBeYoiOMV0QHGnZHBK7Uv0TLPeqAsssW9u_9_ELA3ewSWcZok_PhKPjrXyAiqefzLPlctVUKUMSDDop_YoM07LOO9QksRh5r_sQd3GkdwT270D2g&amp;file_name=/QQ20190618-125256.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=f9ec6URvn1BgKrPQnjbKPAr5HN2sxfoxtBFJhU4tpifBeYoiOMV0QHGnZHBK7Uv0TLPeqAsssW9u_9_ELA3ewSWcZok_PhKPjrXyAiqefzLPlctVUKUMSDDop_YoM07LOO9QksRh5r_sQd3GkdwT270D2g&amp;file_name=/QQ20190618-125256.png"></p><p><strong>注意，编译的时间可能会比较长，如果想要多线程编译，那么请在上述命令前执行<code>export FORCE_UNSAFE_CONFIGURE=1</code>后再在make命令后添加<code>-j</code>参数</strong></p><p>编译成功后，再次打开一个终端执行下列命令将文件导出即可</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker cp openwrt://home/build/openwrt/bin/packages/x86_64/base/mentohust_0.3.1-1_x86_64.ipk ~/Desktop|-</span><br></pre></td></tr></table></figure><p>在桌面上即可看见生成的安装包了</p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=bf9fUngoumn5Lw1rGgfIyZZHevRWNfaYcFj1TzKHxTt4nM2kBLqT-kEcGeHNjJz1TKWLHOxaY0pB63vJb3XPEJplEjYe7GXNKvJMzLqgpSvDoCSmbQ_H6GAZ8Hzp2lgQUio5DBS7Ahb1j9lIg4JIMstJiQ&amp;file_name=/QQ20190618-125354.png" alt="!"></p><h4 id="进行拨号"><a href="#进行拨号" class="headerlink" title="进行拨号"></a>进行拨号</h4><ol><li>在PVE的后台管理界面启动openwrt的远程管理界面，获取当前ip</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">service firewall stop #先关闭防火墙，否则可能会无法访问</span><br><span class="line">ifconfig</span><br></pre></td></tr></table></figure><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=b42f2AWh_GCTJca1SuzXB_5UIqtpx-pJTuUypj7DUYcuZH7dxr8-wkx4EhFNMzqpa1fb5JHKCzsa0su9z5yQxUnBsRH-w0CkGjZjpw_7i_1u2y-a7vtUU7Dncr9SgSR6VMqYfHLdnPNePd4IU3vJRPsTZw&amp;file_name=/QQ20190620-091822.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=b42f2AWh_GCTJca1SuzXB_5UIqtpx-pJTuUypj7DUYcuZH7dxr8-wkx4EhFNMzqpa1fb5JHKCzsa0su9z5yQxUnBsRH-w0CkGjZjpw_7i_1u2y-a7vtUU7Dncr9SgSR6VMqYfHLdnPNePd4IU3vJRPsTZw&amp;file_name=/QQ20190620-091822.png"></p><blockquote><p>我们可以看到有两个ip，这里我们使用<code>192.168.32.108</code>的地址登录</p></blockquote><ol start="2"><li>使用浏览器登录软路由的后台管理界面，进行如下设置</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">系统 &gt; 管理权 &gt; ssh访问</span><br><span class="line">允许 SSH 密码验证</span><br><span class="line">允许 root 用户凭密码登录</span><br></pre></td></tr></table></figure><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=7d564msSC1hOpzxvCewUwgoXo5zaOCLkuHBTOb-mZ8IfjAHPNQec3sLJAVmTJ_JkLP9jh13ZOd4cwNEdSajv8F7En5dUhzfX6kii-Lfez4xXINW3c_L2q7xaqoa9XemtNv4Q_cjm9bv2eYM9SXQmRCXDgg&amp;file_name=/QQ20190620-172723.png" alt="https://kod.erf172.tk/index.php?share/file&amp;user=102&amp;sid=6PGhtwKA"></p><ol start="4"><li>上传文件</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp ~/Desktop/mentohust_0.3.1-1_x86_64.ipk root@192.168.32.108:/root</span><br></pre></td></tr></table></figure><ol start="5"><li>拨号</li></ol><p>ssh 路由器后台，执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">opkg install mentohust_0.3.1-1_x86_64.ipk</span><br><span class="line">ifconfig  <span class="comment">##查看当前连接校园网的网卡的名称</span></span><br><span class="line">mentohust -uyouraccount -pyourpassword -nyournetwork -d2 -a1  <span class="comment">#不同学校的登录方式不同，需要多次尝试不同的参数</span></span><br></pre></td></tr></table></figure><p>如果提示<code>发送心跳包以保持在线</code>，则证明拨号成功，倘若没有拨号成功，可以查看输出日志来判断什么问题</p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=a7b18in6vs05nGa8VPZTGg-nMT5TcC2kPr2QdFlezxHqlfUD-jPn_07YKDLOpOIRNe2HYizV0fOQm-UHu7-7lsdH8xeDN_5mLyq6OgTn1UJDkwEXJYVjlYmToRSSimxQ02Uh3mdPytAWRkH6o54KIMwT-g&amp;file_name=/QQ20190620-173410.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=a7b18in6vs05nGa8VPZTGg-nMT5TcC2kPr2QdFlezxHqlfUD-jPn_07YKDLOpOIRNe2HYizV0fOQm-UHu7-7lsdH8xeDN_5mLyq6OgTn1UJDkwEXJYVjlYmToRSSimxQ02Uh3mdPytAWRkH6o54KIMwT-g&amp;file_name=/QQ20190620-173410.png"></p><h3 id="启用多拨"><a href="#启用多拨" class="headerlink" title="启用多拨"></a>启用多拨</h3><blockquote><p>mentohust检测运行状态通过是加锁打开mentohust.pid文件，如果加锁成功则说明没有运行，反之运行。所以我们要修改mentohust.pid的文件名才能多拨<br>同理，它的配置文件存放在/etc/mentohust.conf中， 我们还要修改mentohust.conf的文件名才能够保证每个拨号程序能够独立运行</p></blockquote><p>修改代码的话可能会比较繁琐，甚至用有可能会出现编译错误。所以我们使用另一种方式来修改拨号文件</p><h4 id="下载16进制编辑器"><a href="#下载16进制编辑器" class="headerlink" title="下载16进制编辑器"></a>下载16进制编辑器</h4><p>16进制编辑器有很多，我在这里使用了<code>iHex</code>，可以直接去App Store 去下载。Win平台可以使用<code>WinHex</code></p><h4 id="修改mentohust程序文件"><a href="#修改mentohust程序文件" class="headerlink" title="修改mentohust程序文件"></a>修改mentohust程序文件</h4><ol><li>将mentohust文件复制到本地</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp root@192.168.32.108:/usr/sbin/mentohust ~/Desktop</span><br></pre></td></tr></table></figure><ol start="2"><li>使用iHex打开文件，分别搜索<code>mentohust.pid</code>、<code>mentohust.conf</code>。并将其修改为<code>1entohust.pid</code>、<code>1entohust.conf</code>后保存。文件名为<code>1entohust</code></li></ol><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=f6e4C2gE8P1vnUQIgaPiqQ4o98oHbKw5fxnp-RcGMPAXYkixQEOlWqtUrfCr6U-OMlJBlpbjDuDiqj1Y_EyKTnxgj0yhFrR5PAOo3rz4Ep6gyIP5DkzwvlKRorLSUc8ew7tSnGnb_xh8KTFADRQkMm15Tg&amp;file_name=/QQ20190620-173957.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=f6e4C2gE8P1vnUQIgaPiqQ4o98oHbKw5fxnp-RcGMPAXYkixQEOlWqtUrfCr6U-OMlJBlpbjDuDiqj1Y_EyKTnxgj0yhFrR5PAOo3rz4Ep6gyIP5DkzwvlKRorLSUc8ew7tSnGnb_xh8KTFADRQkMm15Tg&amp;file_name=/QQ20190620-173957.png"></p><ol start="3"><li>重复以上的步骤，知道达到你想要的多拨数量</li></ol><p><strong>注意，使用16进制修改器修改时只能替换，不能添加字符!</strong></p><ol start="4"><li>将修改好的文件上传至路由器的<code>/usr/sbin/</code>下</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">scp ~/Desktop/1entohust root@xxx.xxx.xxx.xxx:/usr/sbin</span><br></pre></td></tr></table></figure><h4 id="启用路由器的多拨功能"><a href="#启用路由器的多拨功能" class="headerlink" title="启用路由器的多拨功能"></a>启用路由器的多拨功能</h4><ol><li>浏览器登录路由器管理后台，进行如下设置</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">网络 &gt; 多拨 &gt;</span><br><span class="line">启用多拨</span><br><span class="line">多拨数量选择你想要的数量</span><br><span class="line">保存并应用</span><br><span class="line">网络 &gt; 接口 &gt; 设备配置</span><br><span class="line">修改接口为桥接的网卡</span><br><span class="line">Mac地址修改为一个固定值  #十分重要！！！</span><br><span class="line">保存并应用</span><br></pre></td></tr></table></figure><p><strong>一定要将几个虚拟网口的MAC修改成固定值！！！，否则重启后回因为网口Mac地址改变而导致拨号失败！！！</strong></p><ol start="2"><li>拨号测试</li></ol><p>重复上述步骤即可</p><h4 id="创建开机自启和定时拨号任务"><a href="#创建开机自启和定时拨号任务" class="headerlink" title="创建开机自启和定时拨号任务"></a>创建开机自启和定时拨号任务</h4><blockquote><p>到这里，路由器拨号就成功了。但是，每次重启就要登录后台拨号，掉线后还要继续拨号。体验太差</p></blockquote><h5 id="开机自启"><a href="#开机自启" class="headerlink" title="开机自启"></a>开机自启</h5><ol><li><p>记录一下当前拨号成功的mentohust命令</p></li><li><p>ssh登录路由器后台，修改<code>/etc/rc.local</code>文件</p></li><li><p>将命令复制到文件里面保存即可</p></li></ol><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=bf35ivjmG0_o2840HxeGioY9vs0J6uE5ZDM70wW3Ow7W5SW6kYkeuQ-85qATV4nR0M7A3n5gr4n14-AXEqQe3ieDZdCnf-eUvyTx6Uuj7PzxLK1YwAHsIVXiZT0IiO1Odajae2AHLk4UOsBV-xC9OTHvtA&amp;file_name=/QQ20190620-174141.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=bf35ivjmG0_o2840HxeGioY9vs0J6uE5ZDM70wW3Ow7W5SW6kYkeuQ-85qATV4nR0M7A3n5gr4n14-AXEqQe3ieDZdCnf-eUvyTx6Uuj7PzxLK1YwAHsIVXiZT0IiO1Odajae2AHLk4UOsBV-xC9OTHvtA&amp;file_name=/QQ20190620-174141.png"></p><h5 id="定时拨号"><a href="#定时拨号" class="headerlink" title="定时拨号"></a>定时拨号</h5><p> 使用网页登录路由器后台，在定时任务中输入如下内容</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">*/5 * * * *  mentohust -u121212 -p1212121 -neth0 -d2 -a1  #每5分钟执行一次</span><br></pre></td></tr></table></figure><p>如果定时任务没有启动的话，可以在终端执行<code>service cron start</code>启动定时任务功能</p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=4970mpyyr-b7hf7_1UANvoOtfcjrJjUHnkrrg8Kh1YRyIpAHVozRnl5si5dOF7wqnJzubTTKJi-Q97zw6i7lYkQmz-2hB5QgrJ9ExLi71ZJwKWS-yvXB35RMDvGbrT65u_90oFWEwMTkDBSa2OSABxZ3mQ&amp;file_name=/QQ20190620-174629.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=4970mpyyr-b7hf7_1UANvoOtfcjrJjUHnkrrg8Kh1YRyIpAHVozRnl5si5dOF7wqnJzubTTKJi-Q97zw6i7lYkQmz-2hB5QgrJ9ExLi71ZJwKWS-yvXB35RMDvGbrT65u_90oFWEwMTkDBSa2OSABxZ3mQ&amp;file_name=/QQ20190620-174629.png"></p><h4 id="与硬件路由器连接"><a href="#与硬件路由器连接" class="headerlink" title="与硬件路由器连接"></a>与硬件路由器连接</h4><blockquote><p>硬路由的系统我依旧采用了openwrt，不过大部分的路由器的设置方式是一样的</p></blockquote><h5 id="路由器设置"><a href="#路由器设置" class="headerlink" title="路由器设置"></a>路由器设置</h5><p>浏览器后台登录管理界面，进行和WiFi有关的设置</p><p>取消dhcp</p><p>保存</p><h5 id="连接"><a href="#连接" class="headerlink" title="连接"></a>连接</h5><p>将路由器上lan口和软路由的另一个网口相连，重启开机即可</p><h4 id="enjoy"><a href="#enjoy" class="headerlink" title="enjoy"></a>enjoy</h4><p>放两个速度截图23333333~~~</p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=0eed-ZqmwZq-vFpDiDpoEHnD-cLr3lM0VqS5oOY0p51moTx8Onqv2q57NSoECHnzJWWNj5fvQ-esI6npj7Db2htZ0F7fbhKpB569Rtym9LkV7_KFb2aBmjfe5IsLSradJHVhExIn4LoCIBCZARNCRuNhJw&amp;file_name=/QQ20190620-180416.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=0eed-ZqmwZq-vFpDiDpoEHnD-cLr3lM0VqS5oOY0p51moTx8Onqv2q57NSoECHnzJWWNj5fvQ-esI6npj7Db2htZ0F7fbhKpB569Rtym9LkV7_KFb2aBmjfe5IsLSradJHVhExIn4LoCIBCZARNCRuNhJw&amp;file_name=/QQ20190620-180416.png"></p><p><img src="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=8397OKf41wNo-sNWqR6eINPggME5u4M3ZopCn-cJSw4mdjNGgfydbZyox1NfHWhoJGZBS8fRGalQXBvSQEzm9JVM_Ks_5zsmSKSym2K25Spq6DBW3DkWZ9zXHcFPKbYLJNn4sUzjM-dafIg-92nOnirqCw&amp;file_name=/QQ20190620-180602.png" alt="https://kod.erf172.tk/index.php?user/publicLink&amp;fid=8397OKf41wNo-sNWqR6eINPggME5u4M3ZopCn-cJSw4mdjNGgfydbZyox1NfHWhoJGZBS8fRGalQXBvSQEzm9JVM_Ks_5zsmSKSym2K25Spq6DBW3DkWZ9zXHcFPKbYLJNn4sUzjM-dafIg-92nOnirqCw&amp;file_name=/QQ20190620-180602.png"></p><p>这速度只能以三个字形容，舒服了<del>其实网速还可以再往上的，但是没有账号了</del></p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>折腾了半天终于算是弄完了，撒个花庆祝一下<del>并没有</del></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;夏天到了，突然发现我的小米路由器3好像慢了很多。但是我的钱包却告诉我它还很流畅&lt;br&gt;于是乎我看了一眼桌子上的J1900……  &lt;del&gt;J1900:你不要过来啊&lt;/del&gt;&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Guide" scheme="/categories/Guide/"/>
    
    
      <category term="Server" scheme="/tags/Server/"/>
    
      <category term="Router" scheme="/tags/Router/"/>
    
  </entry>
  
  <entry>
    <title>J1900小主机の折腾记(一)</title>
    <link href="/2019/04/12/J1900-Little-Server-Installation-1/"/>
    <id>/2019/04/12/J1900-Little-Server-Installation-1/</id>
    <published>2019-04-11T21:18:34.000Z</published>
    <updated>2019-05-31T03:42:52.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在咸鱼上发现了一块只卖100元的J1900主板，在思考了一分钟后将它买了下来。<del>虽然成色有点伊拉克，但是100元要什么自行车</del><br>买回来后折腾了一段时间，算是可以勉勉强强的使用了，特此记录一下，用以怀念我失去的头发</p></blockquote><a id="more"></a><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="小主机配置"><a href="#小主机配置" class="headerlink" title="小主机配置"></a>小主机配置</h3><table><thead><tr><th>部件</th><th>信息</th></tr></thead><tbody><tr><td>CPU</td><td>Intel(R) Celeron(R) CPU J1900 @ 1.99GHz</td></tr><tr><td>主板</td><td>Soyo SY-J1900</td></tr><tr><td>内存</td><td>4g DDR3 1333Mhz</td></tr><tr><td>存储</td><td>SAMSUNG PM961 128G Nvme <br> Seagate 320GB 7200RPM HDD <br> 8GB SATA SSD</td></tr></tbody></table><h3 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h3><ol><li>一台显示器</li><li>一块8G 以上的优盘</li><li>一个可以正常使用apt进行安装软件的网络<del>校园网说多了都是泪</del></li></ol><h2 id="安装过程"><a href="#安装过程" class="headerlink" title="安装过程"></a>安装过程</h2><h3 id="Proxmox的安装"><a href="#Proxmox的安装" class="headerlink" title="Proxmox的安装"></a>Proxmox的安装</h3><blockquote><p>一开始我是准备直接使用Proxmox提供的镜像文件将系统安装到8G的SATA 固态上，结果硬盘空间不够…</p><p><img src="https://img.vim-cn.com/4d/5923fc422c327b953170a317d4669ab63919a8.png" alt="screen"><br>只能采用Plan B，先安装一个Debian，然后在Debian上安装Proxmox所需要的组件了<del>常翻车已经报警</del></p></blockquote><h4 id="Debian的下载以及安装"><a href="#Debian的下载以及安装" class="headerlink" title="Debian的下载以及安装"></a>Debian的下载以及安装</h4><h5 id="制作启动优盘"><a href="#制作启动优盘" class="headerlink" title="制作启动优盘"></a>制作启动优盘</h5><ol><li><p>下载<a href="https://mirrors.tuna.tsinghua.edu.cn/debian-cd/current/amd64/iso-cd/debian-9.9.0-amd64-xfce-CD-1.iso" target="_blank" rel="noopener">Debian</a>镜像</p></li><li><p>使用<a href="https://etcher.io/" target="_blank" rel="noopener">etcher</a>将镜像写入优盘写入优盘</p></li></ol><h5 id="插入优盘，进入主板的BIOS，将U盘设置成第一启动设备"><a href="#插入优盘，进入主板的BIOS，将U盘设置成第一启动设备" class="headerlink" title="插入优盘，进入主板的BIOS，将U盘设置成第一启动设备"></a>插入优盘，进入主板的BIOS，将U盘设置成第一启动设备</h5><h5 id="安装Debian"><a href="#安装Debian" class="headerlink" title="安装Debian"></a>安装Debian</h5><ol><li>在系统启动的界面中选择<code>Graphical Install</code></li></ol><p><img src="https://img.vim-cn.com/1b/37c318f72fa3e9263067666d6bfcd57a3c3246.png" alt="GraIns"></p><ol start="2"><li><p>语言设置、地区设置、键盘设置中保持默认即可~~为了最大的兼容性</p></li><li><p><code>hostname</code>中设置一个名称，保持默认也可</p></li></ol><p><img src="https://img.vim-cn.com/21/ac1043175e11eb49a8f9f96f88457ee23306e8.png" alt="hostname"></p><ol start="4"><li><p><code>domain name</code>设置一个域名，随便填写就可以</p><p><img src="https://img.vim-cn.com/27/112ed3d709b38694cc2c8f7b95b30165cda8f6.png" alt="domain"></p></li><li><p>分别设置root账户的密码，新建一个账户并设置密码</p></li><li><p>时区保持默认即可</p></li><li><p>磁盘分区中，选择<code>Guided-use entire disk</code>,选择你所要安装的系统磁盘，如果分区ok的话，选择<code>Finish  partitioning and write changes to disk</code>后确认即可</p></li></ol><p><img src="https://img.vim-cn.com/c6/50b2121bd77259968405398ef163a2abf22b8f.png" alt="gra"></p><p><img src="https://img.vim-cn.com/e4/89dc8ce654961b5bde247a1a67d5d92414c27b.png" alt="disk"></p><ol start="8"><li><p>在<code>Use a network mirror</code>点击yes，选择一个国内的镜像原即可，<code>http proxy</code>保持默认即可</p></li><li><p>在<code>participate in the package usage survey</code>中选择no</p></li></ol><ol start="10"><li>在<code>Software selection</code>中，仅勾选<code>SSH server</code>、<code>standard system utilities</code>即可</li></ol><p><img src="https://img.vim-cn.com/a4/30f298d584c1d23e41b6e34e7aa76f08bec041.png" alt="sshserver"></p><ol start="11"><li>将grub安装至系统磁盘中</li></ol><p><img src="https://img.vim-cn.com/1c/dec696eca7f643aab38c930a208945df578d44.png" alt="grub2"></p><p><img src="https://img.vim-cn.com/af/7e6ef652ce3595f3a1dbeaae2a8096a97a3242.png" alt="grub"></p><ol start="12"><li>安装完成后拔掉优盘后重启即可</li></ol><blockquote><p>注意：如果拔掉显示器后系统无法启动，可以按下图用75欧姆电阻分别连接<code>5-10</code>、<code>4-9</code>、<code>3-8</code>针脚即可<del>实测100欧姆电阻也可以</del><br><img src="https://img.vim-cn.com/1c/c882544cd7ed6a599b46ffaf73a795d7243dcd.jpg" alt="vga"></p></blockquote><h4 id="Debian的初步配置以及Proxmox组件的安装"><a href="#Debian的初步配置以及Proxmox组件的安装" class="headerlink" title="Debian的初步配置以及Proxmox组件的安装"></a>Debian的初步配置以及Proxmox组件的安装</h4><h5 id="apt的初步配置-删除CDROM镜像源"><a href="#apt的初步配置-删除CDROM镜像源" class="headerlink" title="apt的初步配置(删除CDROM镜像源)"></a>apt的初步配置(删除CDROM镜像源)</h5><ol><li>使用root账户登录Debian，并执行以下命令</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">dhclient</span><br><span class="line">vi /etc/apt/sources.list</span><br></pre></td></tr></table></figure><ol start="2"><li>将CDROM开头的镜像源删除并保存</li></ol><p><img src="https://img.vim-cn.com/7a/290f676624327d4a7d3655cf07d495e4bc18c3.png" alt="cdrom"></p><ol start="3"><li>更新软件源即可</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get update</span><br><span class="line">apt-get upgrade</span><br></pre></td></tr></table></figure><h5 id="安装网络组件并查看网址"><a href="#安装网络组件并查看网址" class="headerlink" title="安装网络组件并查看网址"></a>安装网络组件并查看网址</h5><blockquote><p>这里可以登录路由器的后台来查看主机的地址，此处采用另一种方法</p></blockquote><ol><li>执行以下命令即可</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">apt-get install net-tools</span><br><span class="line">ifconfig</span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/f4/26b369716fcc30c99a28a3fbaa022beb5c70cf.png" alt="ifconfig"></p><ol start="2"><li>将ip地址记好，下面就可以使用ssh来远程操作了</li></ol><p><strong>注意：由于Debian系统的限制，在这里使用新建的用户进行登录后再切换为root账户</strong></p><p><img src="https://img.vim-cn.com/50/90438db837f383bebf528863541518452504da.png" alt="ssh"></p><h5 id="Proxmox组件的安装"><a href="#Proxmox组件的安装" class="headerlink" title="Proxmox组件的安装"></a>Proxmox组件的安装</h5><blockquote><p>这里参考了<a href="https://pve.proxmox.com/wiki/Install_Proxmox_VE_on_Debian_Stretch" target="_blank" rel="noopener">Proxmox官方网站的安装教程</a></p></blockquote><ol><li><p>使用ssh远程连接至主机</p></li><li><p>修改hosts文件，添加本机地址</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/hosts</span><br><span class="line"><span class="comment">#将127.0.1.1替换替换成主机地址保存即可</span></span><br><span class="line">hostname --ip-address</span><br><span class="line"><span class="comment">#如果此时返回的是主机的ip地址，即为正常工作</span></span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/8c/d7e606e988a6587baa70f2552e2e6bf9f32d15.png" alt="hosts"></p><p><img src="https://img.vim-cn.com/9b/2d6bb7bb60a76fa2658780a2f5c4bb5c7a5fc5.png" alt="ip"></p><ol start="3"><li>安装Proxmox</li></ol><p>执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">echo</span> <span class="string">"deb http://download.proxmox.com/debian/pve stretch pve-no-subscription"</span> &gt; /etc/apt/sources.list.d/pve-install-repo.list</span><br><span class="line">wget http://download.proxmox.com/debian/proxmox-ve-release-5.x.gpg -O /etc/apt/trusted.gpg.d/proxmox-ve-release-5.x.gpg</span><br><span class="line">apt update &amp;&amp; apt dist-upgrade</span><br><span class="line">apt install proxmox-ve postfix open-iscsi -y</span><br><span class="line">apt remove os-prober</span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/64/6d614f8b0b956d85c752d16f9be22bc4ec2d80.png" alt="install_1"></p><p><img src="https://img.vim-cn.com/0e/ad37d31b5c9d4cb254d6fd5007614ab1b742c3.png" alt="install_2"></p><p><img src="https://img.vim-cn.com/67/fc698a96a64d5440a1d08d79f2a109c10a686e.png" alt="install_3"></p><p><img src="https://img.vim-cn.com/2d/b6dca142982f8a23e2201e698af074319f23cb.png" alt="install_4"></p><ol start="4"><li>等待安装完成后，使用电脑端浏览器访问<code>https://youripaddress:8006</code></li></ol><blockquote><p>Google Chrome等浏览器可能会提示证书问题，无视直接访问即可<br><img src="https://img.vim-cn.com/ef/e720b91949866413466609cc2210df2bf7f41f.png" alt="googlechrome"></p></blockquote><ol start="5"><li>使用root账户登录后，即可进入下一步的设置</li></ol><p><img src="https://img.vim-cn.com/06/826695b5a71c3bbd7df7f08c4996dff5147af9.png" alt="loginsuccess"></p><h5 id="虚拟网卡的创建"><a href="#虚拟网卡的创建" class="headerlink" title="虚拟网卡的创建"></a>虚拟网卡的创建</h5><ol><li><p>使用root账户登录后台</p></li><li><p>点击当前主机节点，依次选择<code>网络设备&gt;创建&gt;Linux Bridge</code></p></li><li><p>将虚拟网卡的桥接端口修改为物理网卡接口名称</p></li><li><p>将IP地址修改为当前主机网址</p></li></ol><p><img src="https://img.vim-cn.com/d8/87746498510e1bdfc75ece3678137f175da0c3.png" alt="ip"></p><ol start="5"><li>保存并重启主机即可</li></ol><h3 id="LVM逻辑卷的搭建以及系统的安装"><a href="#LVM逻辑卷的搭建以及系统的安装" class="headerlink" title="LVM逻辑卷的搭建以及系统的安装"></a>LVM逻辑卷的搭建以及系统的安装</h3><h4 id="LVM逻辑卷创建"><a href="#LVM逻辑卷创建" class="headerlink" title="LVM逻辑卷创建"></a>LVM逻辑卷创建</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fdisk -l    <span class="comment">#查看当前硬盘挂载状态</span></span><br><span class="line"><span class="comment">##可以看到，这里有两块名称为`sdb`、`sdc`的硬盘，我们需要先将这两个硬盘创建PV卷</span></span><br><span class="line">pvcreate /dev/sdb /dev/sdc     <span class="comment">#创建PV卷</span></span><br><span class="line">vgcreate myvg /dev/sdb /dev/sdc  <span class="comment">#创建一个卷组</span></span><br><span class="line">lvcreate -L 4G -n ISO myvg      <span class="comment">#创建一个逻辑卷用来存放ISO镜像</span></span><br><span class="line">mkfs -t ext4 /dev/myvg/ISO      <span class="comment">#格式化ISO卷</span></span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/f3/02026a83f397920e81a60d73ffbf239b9a2f65.png" alt="ISO"></p><h4 id="将逻辑卷挂载至Proxmox中"><a href="#将逻辑卷挂载至Proxmox中" class="headerlink" title="将逻辑卷挂载至Proxmox中"></a>将逻辑卷挂载至Proxmox中</h4><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> /media/</span><br><span class="line">mkdir ISO</span><br><span class="line">mount /dev/myvg/ISO ISO</span><br><span class="line">pvesm add lvm myvg --vgname myvg --content images </span><br><span class="line">pvesm add dir ISO --path /media/ISO --content ISO</span><br></pre></td></tr></table></figure><p>此时打开后台网页管理界面，就可以发现创建的逻辑卷已经挂载上</p><p><img src="https://img.vim-cn.com/9d/95ec994278763d1fd6619dd0b3204a63be817f.png" alt="lvm"></p><h4 id="创建虚拟机并安装"><a href="#创建虚拟机并安装" class="headerlink" title="创建虚拟机并安装"></a>创建虚拟机并安装</h4><ol><li>点击ISO存储节点，依次点击内容&gt;上传，将下载好的系统镜像上传</li></ol><p><img src="https://img.vim-cn.com/77/240020ad1eefc4a01bf6df1628a9f0fd1940ce.png" alt="uploadiso"></p><ol start="2"><li><p>点击新建虚拟机，根据情况设置即可</p></li><li><p>新建完成后启动虚拟机，按照正常步骤安装系统即可</p></li></ol><p><img src="https://img.vim-cn.com/bb/b06c9b1844f47d568b1ac029bfd66fa4deee3b.png" alt="centos"></p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>在这折腾了半天后，终于算是勉强能够使用了。为了准备前段时间的考试就一直鸽到了现在。 下一步的操作应该就是整一个软路由，<del>当然，现在已经弄完了</del>毕竟夏天到了，我那个小米路由3有点顶不住了。。。。</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;在咸鱼上发现了一块只卖100元的J1900主板，在思考了一分钟后将它买了下来。&lt;del&gt;虽然成色有点伊拉克，但是100元要什么自行车&lt;/del&gt;&lt;br&gt;买回来后折腾了一段时间，算是可以勉勉强强的使用了，特此记录一下，用以怀念我失去的头发&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Guide" scheme="/categories/Guide/"/>
    
    
      <category term="Server" scheme="/tags/Server/"/>
    
  </entry>
  
  <entry>
    <title>一些个人博客の安全设置</title>
    <link href="/2019/03/23/Some-Security-Settings-on-Blog/"/>
    <id>/2019/03/23/Some-Security-Settings-on-Blog/</id>
    <published>2019-03-22T19:19:43.000Z</published>
    <updated>2019-09-21T03:53:12.709Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>废了九牛二虎之力将自己的小博客搭起来了，结果服务器天天被炸。。。。<br>既然这样，那就进行一些安全设置，确保不会被炸掉</p></blockquote><a id="more"></a><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>前段时间发现学生主机真的好便宜，忍不住入手了一个。既然入手了，那就搭一个博客吧。废了老半天将博客搭建了起来，本以为只需要经常<del>并不是</del>写一下文章就可以了。结果ssh连上去发现ssh 22端口被炸了几千回。。。。<br>没有办法，只能采取一些措施了，防止哪天被爆破掉。。。<br>当然，用一个比较强的密码也是可以的，<del>主要是记性不好</del>再进行一下安全设置岂不是双倍的快乐？</p><h3 id="主要采用的措施"><a href="#主要采用的措施" class="headerlink" title="主要采用的措施"></a>主要采用的措施</h3><blockquote><ol><li>创建一个git账户</li><li>分别为git 和root 账户设置不同的秘钥登录</li><li>只赋予git账户git权限</li><li>禁用账户的密码登录方式，只保留key登录方式</li><li>修改ssh 22端口为其他端口</li><li>启用HTTPS</li></ol></blockquote><h2 id="开搞"><a href="#开搞" class="headerlink" title="开搞"></a>开搞</h2><h3 id="创建git账户，只赋予git权限"><a href="#创建git账户，只赋予git权限" class="headerlink" title="创建git账户，只赋予git权限"></a>创建git账户，只赋予git权限</h3><ol><li>ssh上远程服务器，并执行以下命令来创建账户   </li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">## 在root账户下进行操作</span></span><br><span class="line">useradd git</span><br><span class="line">passwd git <span class="comment"># 此处创建一个git账户的密码</span></span><br><span class="line">mkdir /home/git</span><br><span class="line">chown git:git -R /home/git</span><br><span class="line">su git <span class="comment">#切换为git账户进行操作</span></span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/c8/4ad4bb335d33f54b7a0d49f315978b6a6277a4.png" alt="1">   </p><ol start="2"><li>在git账户下创建blog.git</li></ol><p>执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mkdir ~/blog</span><br><span class="line"><span class="built_in">cd</span> ~/blog</span><br><span class="line">git init --bare blog.git</span><br><span class="line"><span class="built_in">echo</span> <span class="string">"git --work-tree=/home/blog/www --git-dir=/home/git/blog/blog.git checkout -f"</span> &gt; blog.git/hooks/post-receive</span><br><span class="line">chmod a+x post-receive</span><br></pre></td></tr></table></figure><ol start="3"><li>修改nginx的配置文件指向/home/git/blog/www</li></ol><p>按下<code>Ctrl+D</code>，切换当前git账户为root账户，并修改<code>nginx.conf</code>的文件配置</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不同的nginx安装方式可能nginx.conf的所在位置有所不同</span></span><br><span class="line">vi /etc/nginx/nginx.conf</span><br></pre></td></tr></table></figure><p>找到http项，在里面添加以下内容<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">server_name xxxx.com;</span><br><span class="line">index index.html index.htm index.php default.html default.htm default.php;</span><br><span class="line">root /home/git;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="分别为git和root账户添加不同的密钥"><a href="#分别为git和root账户添加不同的密钥" class="headerlink" title="分别为git和root账户添加不同的密钥"></a>分别为git和root账户添加不同的密钥</h3><ol><li>创建git账户的密钥</li></ol><p>创建git账户的话可以不在秘钥中添加密码，以实现免密码同步<br>在本地计算机上打开终端，依次执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ssh-keygen -t rsa -C xx@xx.com  <span class="comment"># 你的GitHub邮箱~~也可以任意内容~~</span></span><br><span class="line"><span class="comment"># 之后连续按3次回车，保存秘钥文件,文件默认在`~/.ssh/`下</span></span><br><span class="line">chmod 700 ~/.ssh</span><br><span class="line">chmod 600 ~/.ssh/id_rsa</span><br><span class="line">scp ~/.ssh/id_rsa.pub git@xxxxx:~/.ssh  <span class="comment"># xxxxx 为你的服务器地址</span></span><br></pre></td></tr></table></figure><p>使用root账户ssh连接到远程服务器，执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">su git </span><br><span class="line"><span class="built_in">cd</span> ~/.ssh/</span><br><span class="line">mv id_rsa.pub authorized_keys</span><br><span class="line">chmod 600 authorized_keys</span><br><span class="line"><span class="built_in">cd</span> .. &amp;&amp; chmod 700 .ssh/</span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/6f/e76a0cb132a11a6d077bbe89094c102414a305.png" alt="4"></p><ol start="2"><li>创建root秘钥</li></ol><p>处于保险起见，我们为root账户再次创建一个秘钥，这次再秘钥中添加上密码，以保证安全</p><p>将当前git账户切换为root账户，然后执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~</span><br><span class="line">ssh-keygen</span><br><span class="line"><span class="comment"># 第一次回车，选定秘钥存放位置，保持默认即可</span></span><br><span class="line"><span class="comment"># 第二三次回车，设置&amp;&amp;确认创建的秘钥的密码</span></span><br><span class="line"><span class="built_in">cd</span> .ssh</span><br><span class="line">mv id_rsa.pub authorized_keys</span><br><span class="line">chmod 600 authorized_keys </span><br><span class="line"><span class="built_in">cd</span> .. &amp;&amp; chmod 700 .ssh</span><br><span class="line">cat .ssh/id_rsa</span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/e3/bb5321978441645669c36e2c9971980aeced3a.png" alt="5"></p><p>将id_rsa的文件内容复制到本地，保存为key并设置权限为600</p><ol start="3"><li>禁用密码登录并开启密钥登录</li></ol><p>在root账户下执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><p>修改 PasswordAuthentication 项为NO并去掉前方#号</p><p><img src="https://img.vim-cn.com/ff/bcc687627531221b4128f306c897a04d6c706b.png" alt="22"></p><p>保存并退出，重启ssh服务</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/ssh restart</span><br></pre></td></tr></table></figure><p>此时断开连接，再次登录会发现只能使用密钥登录了</p><blockquote><p>注意：强烈建议<strong>先启用密钥登录，断开连接并使用密钥登录成功后再关闭密码登录</strong><del>不要问我为什么强烈建议这么干</del></p></blockquote><h3 id="只赋予git账户git的权限"><a href="#只赋予git账户git的权限" class="headerlink" title="只赋予git账户git的权限"></a>只赋予git账户git的权限</h3><p>使用root连接上远程服务器，修改passwd文件</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/passwd</span><br></pre></td></tr></table></figure><p>将git后面的shell更改为<code>/usr/bin/git-shell</code></p><p><img src="https://img.vim-cn.com/69/6e648f08abf9eff379b7c56a287ae4713f56d1.png" alt="jkl"></p><p>保存并退出，此时输入切换git账户会报错并无法切换</p><p>报错是正常现象，不用担心</p><p><img src="https://img.vim-cn.com/fe/4b2e66dd5ea6a5bbd53e8127d10f37dd47e942.png" alt="sd"></p><h3 id="修改ssh默认22端口为其他端口"><a href="#修改ssh默认22端口为其他端口" class="headerlink" title="修改ssh默认22端口为其他端口"></a>修改ssh默认22端口为其他端口</h3><ol><li>在远程服务器上修改sshd_config文件</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">vi /etc/ssh/sshd_config</span><br></pre></td></tr></table></figure><ol start="2"><li>修改port为其他端口，端口号大于10000都可以</li></ol><p><img src="https://img.vim-cn.com/ef/ef9c618ce0bed6ebf75337b9e1d7a8ffb491d1.png" alt="jklkl"></p><ol start="3"><li>重新启动ssh服务</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">/etc/init.d/ssh restart</span><br></pre></td></tr></table></figure><ol start="4"><li>重新断开连接，会发现使用ssh无法使用22端口登录，需要改为当前设定端口<del>我号要没了</del></li></ol><blockquote><p>如果修改失败并且无法登录了，可通过服务器管理网页上的vnc连接来重复上述步骤进行修改 <del>再次不要问我为什么知道</del></p></blockquote><h3 id="hexo中的配置"><a href="#hexo中的配置" class="headerlink" title="hexo中的配置"></a>hexo中的配置</h3><p>修改 _config.yml,添加以下内容</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#  aaaa为你的服务器地址，bbbb为你的设置的端口号</span></span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">  type:</span> <span class="string">git</span></span><br><span class="line"><span class="attr">  repo:</span>  </span><br><span class="line"><span class="attr">          server:</span> <span class="attr">ssh://git@aaaa:bbbb/home/git/blog/blog.git</span></span><br><span class="line"><span class="attr">  branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/94/b2b1a1fb26b319773ee29c15d47febe3e773b5.png" alt="das"></p><p>这样就可以执行hexo d 将本地文件推动到远程服务器上了</p><h3 id="启用https登录"><a href="#启用https登录" class="headerlink" title="启用https登录"></a>启用https登录</h3><p>HTTPS证书的话免费的有很多，在这里以使用<a href="https://letsencrypt.org" target="_blank" rel="noopener">Let’sEncrypt</a>为例</p><p>Let‘s Enycrypt 的https的证书可以在 <a href="https://certbot.eff.org" target="_blank" rel="noopener">这个网站</a>这里按照提示快速安装，这里以nginx Ubuntu16.04 LTS为例</p><ol><li>在上述网站选择合适的系统类型，这里选择nginx、Ubuntu 16.04 LTS 并确定</li></ol><p><img src="https://img.vim-cn.com/a8/047175c9b4f06c1f6e444901c62da30429be4f.png" alt="zcas"></p><ol start="2"><li><p>点击确定，稍后的页面会给出安装的命令，复制到远程的服务器上运行即可</p></li><li><p>然后执行以下命令进行自动安装</p></li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot --nginx</span><br></pre></td></tr></table></figure><p>自动安装后再次访问主页面即可发现网页已经启用https了</p><ol start="4"><li>启动https证书的自动续期</li></ol><p>执行以下命令</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">certbot renew --dry-run</span><br></pre></td></tr></table></figure><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>折腾了一大堆，安全措施差不多就ok，当然，最保险的还是定期更换一下，以保证不会被黑掉</p><p><del>折腾的过程真的掉头发，想想下面该写点什么</del></p><p><del>我爱单片机，单片机使我快乐</del></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;废了九牛二虎之力将自己的小博客搭起来了，结果服务器天天被炸。。。。&lt;br&gt;既然这样，那就进行一些安全设置，确保不会被炸掉&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Guide" scheme="/categories/Guide/"/>
    
    
      <category term="Server" scheme="/tags/Server/"/>
    
      <category term="Blog" scheme="/tags/Blog/"/>
    
  </entry>
  
  <entry>
    <title>联想小新锐7000の黑苹果折腾记(二)</title>
    <link href="/2019/02/18/Hackintosh-Installation-on-Lenovo-Xiaoxin-Rui7000-2/"/>
    <id>/2019/02/18/Hackintosh-Installation-on-Lenovo-Xiaoxin-Rui7000-2/</id>
    <published>2019-02-17T17:20:22.000Z</published>
    <updated>2019-03-21T14:08:14.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>经过上一次的折(翻)腾(车)，系统我们已经安装好了。下面我们进行苹果系统的调试工作<br>注意，这个过程可能会多次翻车。一定要有耐心233333</p></blockquote><a id="more"></a><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><p>下面的修改工作可以分为以下几个部分，大家可以按需阅读233333<br>不过我还是建议通读一遍，以保证系统的稳定运行</p><blockquote><p>将CLOVER系统文件移动到硬盘的EFI分区中<br>屏蔽独显&amp;核显的驱动<br>正确驱动核显<br>修复亮度调节<br>正确驱动声卡<br>正确驱动网卡<br>USB端口注入<br>开启CPU变频<br>启用睡眠</p></blockquote><h2 id="安装后的调试工作"><a href="#安装后的调试工作" class="headerlink" title="安装后的调试工作"></a>安装后的调试工作</h2><h3 id="将CLOVER移动至系统EFI分区中"><a href="#将CLOVER移动至系统EFI分区中" class="headerlink" title="将CLOVER移动至系统EFI分区中"></a>将CLOVER移动至系统EFI分区中</h3><ol><li>打开终端，输入以下命令来查看本地EFI引导的磁盘分区</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskutil list</span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/9f/260bf10fa02161c9f090eed7cc3c0152969305.png" alt="DiskLisat"></p><ol start="2"><li>确定磁盘分区之后，输入以下命令。比如，我的磁盘EFI分区是disk0s2，优盘的EFI分区是disk4s2</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo diskutil mount disk0s2</span><br><span class="line">sudo diskutil mount disk4s1</span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/a7/20fd4142a13699e1c3e4557f936c2a02f7d361.png" alt="DiskMount"></p><ol start="3"><li>打开访达，分别打开本地磁盘上的EFI分区以及优盘上的EFI分区</li></ol><ol start="4"><li>将CLOVER文件夹复制到磁盘的EFI目录下</li></ol><p><img src="https://img.vim-cn.com/61/cb997dc8349fdabae1137216ffd5ba05786660.png" alt="EFI_COPY"></p><ol start="5"><li>在Windows下下载<a href="https://dl.pconline.com.cn/download/84210.html" target="_blank" rel="noopener">BOOTICE</a>并打开</li></ol><blockquote><p>其实这里可以先在macOS下继续下面的操作，然后重启的时候再搞<br>为什么不直接在Windows下搞呢？因为Windows下需要权限才能访问EFI分区。。<br><img src="https://img.vim-cn.com/58/a18a66f2e925fda6516bafeeb3cb22ec178639.png" alt="BOOTICE_1"></p></blockquote><ol start="4"><li>选择你EFI分区所在的磁盘，然后打开分区编辑选项</li></ol><p><img src="https://img.vim-cn.com/6e/d77e17f235c26df0cff47a7bc03cd5c1d992da.png" alt="ERROR"></p><ol start="5"><li>在分区管理页面里面选择ESP分区&gt;分配盘符然后确定就好</li></ol><p><img src="https://img.vim-cn.com/3d/a74a7b34bdba575c71c39bde74c5af8b8a6629.png" alt="BOOTICE_2"></p><ol start="6"><li>关闭分区管理，依次点击UEFI&gt;修改启动设置</li></ol><p><img src="https://img.vim-cn.com/5f/86cec4b3124b23ae458f5d77e6057831a99aa5.png" alt="BOOTICE_3"></p><ol start="7"><li>然后在启动项修改页面中点击添加，选择EFI&gt;&gt;CLOVER&gt;&gt;CLOVERX64.efi</li></ol><p><img src="https://img.vim-cn.com/6d/0325ebaeab9cdcf4ba3515d1ada03807e86309.png" alt="BOOTICE_4"></p><ol start="8"><li>修改完成后保存并将其移动到最顶端</li></ol><p><img src="https://img.vim-cn.com/2e/0e4b9653788b9d23a2076c5b1c86117c72032f.png" alt="BOOTICE_5"></p><h3 id="屏蔽独显-amp-核显的驱动"><a href="#屏蔽独显-amp-核显的驱动" class="headerlink" title="屏蔽独显&amp;核显的驱动"></a>屏蔽独显&amp;核显的驱动</h3><ol><li>打开App Store ，搜索Xcode并安装</li></ol><p><img src="https://img.vim-cn.com/5d/2a9f1af5fcc489c7bd2f4cdf5c66d78e233569.png" alt="Xcode"></p><ol start="2"><li>打开终端，依次输入以下命令</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> Desktop</span><br><span class="line">mkdir Hackintosh_Project&amp;&amp;<span class="built_in">cd</span> Hackintosh_Project</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/RehabMan/OS-X-Clover-Laptop-Config.git</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/acpica/acpica.git</span><br><span class="line"><span class="built_in">cd</span> acpica</span><br><span class="line">make -j8 </span><br><span class="line"><span class="built_in">cd</span> .. &amp;&amp; <span class="built_in">cd</span> OS-X-Clover-Laptop-Config/hotpatch</span><br><span class="line">iasl SSDT-DDGPU.dsl SSDT-PNLF.dsl SSDT-IGPU.dsl SSDT-GPRW.dsl SSDT-PTSWAK.dsl SSDT-XOSI.dsl SSDT-ALS0.dsl</span><br></pre></td></tr></table></figure><blockquote><p>如果提示找不到iasl的话，可以使用下列命令安装后再次进入OS-X-Clover-Laptop-Config/hotpatch进行编译<br>cd ~/Desktop/Hackintosh_project/acpia/ &amp;&amp; sudo make install<br>我的电脑都编译的话莫名其妙会报错，所以只编译了一些需要的文件<br>正常情况下直接在OS-X-Clover-Laptop-Config下执行make即可</p></blockquote><ol start="3"><li><p>分别下载<a href="https://bitbucket.org/RehabMan/os-x-maciasl-patchmatic/downloads/" target="_blank" rel="noopener">Maciasl</a>、下载 <a href="https://mackie100projects.altervista.org/download-clover-configurator/" target="_blank" rel="noopener">Clover Configurator</a>、<a href="http://headsoft.com.au/download/mac/Hackintool.zip" target="_blank" rel="noopener">Hackintool</a>，保存在桌面备用   </p></li><li><p>将本地磁盘的EFI分区挂载，删除CLOVER/ACPI/patched</p></li><li><p>将 Hackintosh_Project/Hackintosh_Project/OS-X-Clover-Laptop-Config/hotpatch 下的 SSDT-DDGPU.aml SSDT-IGPU.aml 复制到CLOVER/ACPI/patched</p></li><li><p>打开Clover Configurator，然后选择EFI/CLOVER/config.plist 并进行以下操作后保存</p></li></ol><blockquote><p>ACPI:删除patches下的change PCI0.VID to IGPU #1 (Thinkpad)和change PCI0.VID to IGPU #2 (Thinkpad)<br>Boot:删除-disablegfxfirmware参数<br>Devices:删除所有Add Properties选项<br>Graphics:取消勾选Inject ATI ,Injecr Nvdia选项<br>SystemParameters:将inject Kexts修改为YES</p></blockquote><ol start="7"><li>点击Properties，并进行如下的设置</li></ol><blockquote><p>去掉<code>#1 framebuffer-con1-alldata</code>、<code>#1 framebuffer-con1-enable</code>、<code>#framebuffer-con1-type</code>前面的#号<br>然后分别添加以下参数</p><blockquote><table><thead><tr><th>Properties Key</th><th>Properties Value</th><th>Value Type</th></tr></thead><tbody><tr><td>disable-external-gpu</td><td>01000000</td><td>Data</td></tr><tr><td>enable-hdmi20</td><td>01000000</td><td>Data</td></tr><tr><td>framebuffer-portcount</td><td>02000000</td><td>Data</td></tr></tbody></table><p>剩下的#号部分可以删除<br><img src="https://img.vim-cn.com/0e/844f9190aedbf208c7a5734ee199248ace4cf1.png" alt="GPU"></p></blockquote></blockquote><ol start="8"><li>重启即可完成独显的屏蔽以及核显的驱动。</li></ol><blockquote><p>倘若卡住无法进入系统，可以先将在clover引导界面中依次选择<code>Opinions&gt;Graphics Injector</code>将FakeID 改成<code>0x12345678</code>即可进入系统<br><img src="https://img.vim-cn.com/cf/53b4ceefa7a8f3cc2e5a9e89bc4f5445d3033b.png" alt="Fakeid"></p></blockquote><h3 id="亮度调节的修复"><a href="#亮度调节的修复" class="headerlink" title="亮度调节的修复"></a>亮度调节的修复</h3><ol><li><p>下载<a href="https://bitbucket.org/RehabMan/applebacklightfixup/downloads/" target="_blank" rel="noopener">ApplebacklightFixup</a></p></li><li><p>将SSDT—PNLF.aml复制到EFI/CLOVER/ACPI/patched下</p></li><li><p>将AppleBacklightFixup.kext复制到EFI/CLOVER/kexts/Other下</p></li><li><p>复制Hackintosh_Project/OS-X-Clover-Laptop-Config/hotpatch下的SSDT-ALS0.aml到EFI/CLOVER/ACPI/patched下</p></li><li><p>下载<a href="https://dl.pconline.com.cn/download/1406463.html" target="_blank" rel="noopener">Kext Utility</a>,打开刷新缓存后重启即可修复亮度</p></li></ol><blockquote><p>倘若亮度没有修复，可以打开Kext Utility 并将ApplebacklightFixup.kext 拖入安装到S/L/E后重启即可</p></blockquote><h3 id="声卡的驱动"><a href="#声卡的驱动" class="headerlink" title="声卡的驱动"></a>声卡的驱动</h3><ol><li><p>下载<a href="https://github.com/acidanthera/AppleALC/releases" target="_blank" rel="noopener">AppleALC</a></p></li><li><p>将AppleALC.kext复制到/EFI/CCLOVER/kexts/Other下</p></li><li><p>打开Clover Configurator，进行以下设置并保存</p></li></ol><blockquote><p>Devices:删除PciRoot(0x0)/Pci(0x1f,0x3)下的所有参数，新建项加入以下参数</p><blockquote><table><thead><tr><th>Properties Key</th><th>Properties Value</th><th>Value Type</th></tr></thead><tbody><tr><td>layout-id</td><td>1C000000</td><td>DATA</td></tr></tbody></table></blockquote></blockquote><ol start="4"><li>用kext Utility刷新缓存重启即可</li></ol><h3 id="网卡的驱动"><a href="#网卡的驱动" class="headerlink" title="网卡的驱动"></a>网卡的驱动</h3><blockquote><p>电脑自带的Realtek(或者Intel)无线网卡是无法驱动的，所以我更换了博通的BCM94352z无线网卡</p></blockquote><ol><li><p>下载<a href="https://bitbucket.org/RehabMan/os-x-brcmpatchram/downloads" target="_blank" rel="noopener">BrcmPatchRAM</a>和<a href="https://github.com/acidanthera/AirportBrcmFixup/releases" target="_blank" rel="noopener">AirportBrcmFixup</a></p></li><li><p>将BrcmPatchRAM下的 BrcmFirmwareData.kext、BrcmPatchRAM2.kext 以及AirportBrcmFixup下的AirportBrcmFixup.kext复制到/EFI/CLOVER/kexts/Other下</p></li><li><p>用kext Utility刷新缓存重启即可</p></li></ol><blockquote><p>倘若出现睡眠后失灵的状况，可以将以上3个kext文件安装到S/L/E下即可解决</p></blockquote><h3 id="USB端口注入"><a href="#USB端口注入" class="headerlink" title="USB端口注入"></a>USB端口注入</h3><ol><li><p>打开hackintool，点击usb图标</p></li><li><p>分别用一个usb2.0与usb3.0的设备在电脑上的3个usb3.0的设备插拔一次</p></li></ol><p><img src="https://img.vim-cn.com/c4/233b492c7478e1fcbdb8a7a987eae10193482b.png" alt="USB1"></p><ol start="3"><li>将非绿色的端口全部删除，即保留HS01、HS02、HS03、HS05、HS07、SS01、SS02</li></ol><p><img src="https://img.vim-cn.com/f7/c1aa6f66c2411d3833367a17b15c0398d34e4f.png" alt="Usb2"></p><ol start="4"><li><p>点击下方的Export图标，将生成的USBport.kext放EFI/CLOVER/kexts/Other下，并删除USBinjectAll.kext</p></li><li><p>将hotpatch下的SSDT-XOSI.aml 复制到/EFI/CLOVER/ACPI/Patched下</p></li><li><p>修改config.plist，在ACPI:Patched 添加以下内容（可以从hotpatch下的config.plist复制)</p></li></ol><blockquote><table><thead><tr><th>Comment</th><th>Find</th><th>Replace</th></tr></thead><tbody><tr><td>change _OSI to XOSI, pair with SSDT-XOSI.aml</td><td>5F4F5349</td><td>584F5349</td></tr></tbody></table></blockquote><ol start="7"><li>刷新缓存并重启即可</li></ol><h3 id="CPU变频开启"><a href="#CPU变频开启" class="headerlink" title="CPU变频开启"></a>CPU变频开启</h3><ol><li>打开终端，执行以下命令</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/Desktop/Hackintosh_Project</span><br><span class="line">git <span class="built_in">clone</span> https://github.com/acidanthera/CPUFriend.git</span><br><span class="line">cp /System/Library/Extensions/IOPlatformPluginFamily.kext/Contents/PlugIns/X86PlatformPlugin.kext/Contents/Resources/Mac-B4831CEBD52A0C4C.plist  ~/Desktop/Hackintosh_Project/CPUFriend/ResouceConverter</span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/c2/71a0aefee8ddabf9a65f8d4e5f85d26b7c28a6.png" alt="CPU_1"></p><ol start="2"><li>打开Xcode编辑Mac-B4831CEBD52A0C4C.plist进行以下修改</li></ol><blockquote><p>在Root&gt;IOPlatformPowerProfile中添加以下选项</p><table><thead><tr><th>Key</th><th>Type</th><th>Value</th></tr></thead><tbody><tr><td>power_reduced_playback</td><td>Boolean</td><td>Yes</td></tr><tr><td>thermally_optimized_xcode</td><td>Boolean</td><td>Yes</td></tr><tr><td>thermally_optimized_maps</td><td>Boolean</td><td>Yes</td></tr><tr><td>optimized_photobooth</td><td>Boolean</td><td>Yes</td></tr><tr><td>optimized_screensavers</td><td>Boolean</td><td>Yes</td></tr><tr><td>optimized_slideshows</td><td>Boolean</td><td>Yes</td></tr><tr><td>optimized_visualizers</td><td>Boolean</td><td>Yes</td></tr></tbody></table><p>在Frequencies 中添加一行键值为3800<br>在FrequencyVectors 复制其中一行的键值，index与Frequencies中的3800相对应，并将第二组数据改成08000000<br>他们看起来是这个样子的<br><img src="https://img.vim-cn.com/bd/a561711c9641b4d70484a20889ee12407ca0ac.png" alt="CPU_2"></p></blockquote><ol start="3"><li>打开终端执行以下命令</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> ~/Desktop/Hackintosh_Project/CPUFriend/ResouceConverter</span><br><span class="line">./ResourceConverter.sh --kext Mac-B4831CEBD52A0C4C.plist</span><br><span class="line">./ResourceConverter.sh --acpi Mac-B4831CEBD52A0C4C.plist</span><br><span class="line">sudo cp Mac-B4831CEBD52A0C4C.plist /System/Library/Extensions/IOPlatformPluginFamily.kext/Contents/PlugIns/X86PlatformPlugin.kext/Contents/Resources/Mac-B4831CEBD52A0C4C.plist</span><br></pre></td></tr></table></figure><ol start="4"><li>新建终端，执行以下命令</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">curl -o ~/ssdtPRGen.sh https://raw.githubusercontent.com/Piker-Alpha/ssdtPRGen.sh/Beta/ssdtPRGen.sh</span><br><span class="line">chmod +x ~/ssdtPRGen.sh</span><br><span class="line">sudo ~/ssdtPRGen.sh</span><br></pre></td></tr></table></figure><ol start="5"><li><p>编辑生成的ssdt.dsl文件，将刚才生成的ssdt_data 中的cf-frequency-data复制到Method (_DSM, 4, NotSerialized)中，并Package（0x02）改为Package（0x04），将文件保存为aml后退出</p></li><li><p>将刚修改的ssdt.aml复制到/EFI/CLOVER/ACPI/Patched中，将CPUFriend.kext、CPUFriendProvider.kext放到/EFI/CLOVER/kexts/Other里</p></li><li><p>刷新缓存重启即可</p></li></ol><h3 id="启用睡眠"><a href="#启用睡眠" class="headerlink" title="启用睡眠"></a>启用睡眠</h3><ol><li><p>将前文中编译的SSDT-GPRW.aml SSDT-PTSWAK.aml 复制到/EFI/CLOVER/ACPI/Patched中</p></li><li><p>用CloverConfigurator打开config.plist,在ACPI/Patched中添加如下选项(可以从hotpatch下的config中复制)</p></li></ol><blockquote><table><thead><tr><th>Comment</th><th>Find</th><th>Replace</th></tr></thead><tbody><tr><td>change Method(_PTS,1,N) to ZPTS, pair with SSDT-PTSWAK.aml</td><td>5F505453 01</td><td>5A505453 01</td></tr><tr><td>change Method(_WAK,1,N) to ZWAK, pair with SSDT-PTSWAK.aml</td><td>5F57414B 01</td><td>5A57414B 01</td></tr><tr><td>change Method(GPRW,2,N) to XPRW, pair with SSDT-GPRW.aml</td><td>47505257 02</td><td>58505257 02</td></tr></tbody></table></blockquote><ol start="3"><li>保存重启即可</li></ol><blockquote><p>注意：倘若之前在BIOS中关闭了显卡，可能会导致启动时卡在+++不动</p></blockquote><h3 id="显示器EDID的注入"><a href="#显示器EDID的注入" class="headerlink" title="显示器EDID的注入"></a>显示器EDID的注入</h3><blockquote><p>使用HDMI的时候可能会导致笔记本屏幕黑屏，可以通过注入edid解决</p></blockquote><ol><li><p>打开hackintool，点击显示器，设置一个合适的屏幕类型点击屏幕下方的+号添加分辨率后再点击生成按键</p></li><li><p>将生成的DisplayVendorID-6af放到/System/Library/Displays/Contents/Resources/Override 下即可</p></li><li><p>刷新缓存并重启即可</p></li></ol><blockquote><p>如果无效或者启动后显示屏黑屏，可以考虑外接显示器或者进入恢复模式删除edid文件</p></blockquote><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><blockquote><p>EFI 地址:<a href="https://github.com/Erf172/Lenovo_XiaoXin_Rui7000_Hackintosh" target="_blank" rel="noopener">Github</a></p></blockquote><p>到这里黑苹果调试的差不多了，就可以使用了。当然还有很多地方没有修复，以后会慢慢修复的。。。</p><p><del>一时咸鱼一时爽，一直咸鱼一直爽</del></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;经过上一次的折(翻)腾(车)，系统我们已经安装好了。下面我们进行苹果系统的调试工作&lt;br&gt;注意，这个过程可能会多次翻车。一定要有耐心233333&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Guide" scheme="/categories/Guide/"/>
    
    
      <category term="MacOS" scheme="/tags/MacOS/"/>
    
      <category term="系统安装" scheme="/tags/%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/"/>
    
  </entry>
  
  <entry>
    <title>联想小新锐7000の黑苹果折腾记(一)</title>
    <link href="/2019/02/13/Hackintosh-Installation-on-Lenovo-Xiaoxin-Rui7000-1/"/>
    <id>/2019/02/13/Hackintosh-Installation-on-Lenovo-Xiaoxin-Rui7000-1/</id>
    <published>2019-02-12T16:47:34.000Z</published>
    <updated>2019-03-22T05:05:11.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>在经历了让人头秃的期末考试之后，终于可以着手继续折腾黑苹果了2333333<br>经过无数次翻车与删库跑路之后，终于调整成了可以使用的样子，特此记录一下下，怀念我失去的头发。。。。</p></blockquote><a id="more"></a><h2 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h2><h3 id="电脑配置明细"><a href="#电脑配置明细" class="headerlink" title="电脑配置明细"></a>电脑配置明细</h3><table><thead><tr><th>部件</th><th>信息</th></tr></thead><tbody><tr><td>CPU</td><td>Intel(R) Core(TM) i7-7700HQ CPU @ 2.80GHz</td></tr><tr><td>内存</td><td>8g DDR4 2400Mhz x2</td></tr><tr><td>存储</td><td>TOSHIBA Xg3 256G Nvme <br> TOSHIBA 1TB 5400RPM HDD</td></tr><tr><td>显卡</td><td>Intel HD Graphics 630 <br> NVIDIA GeForce GTX 1050</td></tr><tr><td>声卡</td><td>Realtek ALC235</td></tr><tr><td>有线网卡</td><td>Realtek RTL8111 PCI-E Gigabit Ethernet Adapter</td></tr><tr><td>无线网卡</td><td>Broadcom BCM94352z 802.11ac Wireless Network Adapter</td></tr></tbody></table><h3 id="系统截图"><a href="#系统截图" class="headerlink" title="系统截图"></a>系统截图</h3><p><img src="https://img.vim-cn.com/6a/9ffd8b467320a6a6d5be385263b456cafd1888.png" alt="SysScreen"><br><img src="https://img.vim-cn.com/49/5369b1e3bfd366b259dcd7aaa3d1ebdc77ade5.png" alt="SysScreen"><br><img src="https://img.vim-cn.com/ca/f827ce420e148d75a905f8fd8c293272f9688f.png" alt="SysScreen"><br><img src="https://img.vim-cn.com/0e/5ad521869b78531f3f094a10c3d8f747d4b703.png" alt="SysScreen"><br><img src="https://img.vim-cn.com/2d/52e5b23fd51d3d54d48c641c18d31aae6bb9c7.png" alt="SysScreen"></p><h3 id="已知问题"><a href="#已知问题" class="headerlink" title="已知问题"></a>已知问题</h3><ol><li>亮度快捷按键调节不可用     </li><li>亮度的最后一档相当于黑屏   </li><li>FaceTime &amp; IMessage 不可用 (可以自己手动洗白)   </li></ol><h3 id="适用于的系统"><a href="#适用于的系统" class="headerlink" title="适用于的系统"></a>适用于的系统</h3><p>  macOS High Sierra 10.13.6<br>  macOS Mojave 10.14</p><h3 id="准备工具"><a href="#准备工具" class="headerlink" title="准备工具"></a>准备工具</h3><p> 容量大于等于8G的优盘<br> 笔记本电脑<br> 网线(或者使用手机开启USB网络共享)</p><blockquote><p>系统镜像是采用的<a href="https://blog.daliansky.net/" target="_blank" rel="noopener">黑果小兵</a>大佬制作的macOS High Sierra 10.13.6(17G2112) Installer with Clover 4606镜像，在这里感谢黑果小兵大佬<br>教程可能会比较啰嗦，希望大家能够体谅一下233333<br>部分网站可能需要加速才能顺利访问，自备工具</p></blockquote><h2 id="安装前的准备工作"><a href="#安装前的准备工作" class="headerlink" title="安装前的准备工作"></a>安装前的准备工作</h2><h3 id="下载MacOS系统安装镜像以及启动盘的制作"><a href="#下载MacOS系统安装镜像以及启动盘的制作" class="headerlink" title="下载MacOS系统安装镜像以及启动盘的制作"></a>下载MacOS系统安装镜像以及启动盘的制作</h3><ol><li>在Windows下下载<a href="https://blog.daliansky.net/macOS-High-Sierra-10.13.6-17G2112-Release-Special-with-Clover-4606-original-mirror.html" target="_blank" rel="noopener">macOS High Sierra 10.13.6(17G2112) Installer with Clover 4606镜像</a>   </li><li>下载<a href="https://etcher.io/" target="_blank" rel="noopener">etcher</a>并安装   </li><li>插入优盘，打开etcher，选择下载好的镜像并选择优盘写入   </li></ol><p><img src="https://img.vim-cn.com/85/c0b7189b77de5da14811c3e6b3085170cce083.png" alt="etcher">   </p><blockquote><p><strong>注意，写入镜像会清除优盘的所有数据，请注意备份文件</strong>   </p></blockquote><h3 id="Windows下macOS虚拟机的创建"><a href="#Windows下macOS虚拟机的创建" class="headerlink" title="Windows下macOS虚拟机的创建"></a>Windows下macOS虚拟机的创建</h3><ol><li>下载并安装<a href="https://www.virtualbox.org/wiki/Downloads" target="_blank" rel="noopener">VirtualBox</a>   </li><li>打开VirtualBox，点击管理&gt;全局设定&gt;扩展，安装扩展程序(<strong>需要将许可拉到最底下才能同意</strong>)   </li></ol><p><img src="https://img.vim-cn.com/f5/884fc80d120a2b26081dc710d872d5781c8df7.png" alt="VBox扩展"></p><ol start="3"><li>新建MacOS的虚拟机并将硬件设置中的核心数以及内存占用适当调大一些    </li><li>在Mac虚拟机的设置&gt;USB设备中添加制作好系统镜像的优盘   </li></ol><p><img src="https://img.vim-cn.com/5b/ba3bc489a45495a282c5331de00a57504c0d43.png" alt="VBOXUSB"></p><ol start="5"><li>打开CMD窗口，并输入以下命令</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"># Mac为你所创建的虚拟机名称</span><br><span class="line">cd &quot;C:\Program Files\Oracle\VirtualBox&quot;</span><br><span class="line"></span><br><span class="line">VBoxManage.exe modifyvm &quot;Mac&quot; --cpuidset 00000001 000106e5 00100800 0098e3fd bfebfbff</span><br><span class="line"></span><br><span class="line">VBoxManage setextradata &quot;Mac&quot; &quot;VBoxInternal/Devices/efi/0/Config/DmiSystemProduct&quot; &quot;iMac11,3&quot;</span><br><span class="line"></span><br><span class="line">VBoxManage setextradata &quot;Mac&quot; &quot;VBoxInternal/Devices/efi/0/Config/DmiSystemVersion&quot; &quot;1.0&quot;</span><br><span class="line"></span><br><span class="line">VBoxManage setextradata &quot;Mac&quot; &quot;VBoxInternal/Devices/efi/0/Config/DmiBoardProduct&quot; &quot;Iloveapple&quot;</span><br><span class="line"></span><br><span class="line">VBoxManage setextradata &quot;Mac&quot; &quot;VBoxInternal/Devices/smc/0/Config/DeviceKey&quot; &quot;ourhardworkbythesewordsguardedpleasedontsteal(c)AppleComputerInc&quot;</span><br><span class="line"></span><br><span class="line">VBoxManage setextradata &quot;Mac&quot; &quot;VBoxInternal/Devices/smc/0/Config/GetKeyFromRealSMC&quot; 1</span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/ad/9f27a8aab72727bff8a9185026cc736583a16d.png" alt="VBox命令"></p><ol start="6"><li>设置完成之后启动虚拟机，在EFIshell中输入exit进入BIOS进行设置   </li><li>依次选择Boot Maintenance Mamager&gt;&gt;Boot From File&gt;&gt;”\,xxxxxxxxxx(<strong>不是EFI</strong>)”&gt;&gt;System&gt;&gt;Library&gt;&gt;CoreService&gt;&gt;boot.efi稍等片刻即可进入安装界面   </li></ol><p><img src="https://img.vim-cn.com/00/205e458e36a04851ba9029d38f01d0d69e7490.png" alt="EFI_USB"></p><h3 id="MacOS系统的安装"><a href="#MacOS系统的安装" class="headerlink" title="MacOS系统的安装"></a>MacOS系统的安装</h3><ol><li>选择简体中文后在弹出的MacOS使用工具中选择磁盘工具   </li></ol><p><img src="https://img.vim-cn.com/e2/2607b9e6b34d091e090fe8ae185da477888feb.png" alt="OS_INSTALL_VBOX_1">   </p><ol start="2"><li>抹掉相应的磁盘(不知道那一块硬盘可以先选择显示所有宗卷)   </li></ol><p><img src="https://img.vim-cn.com/40/522bb91b3a0657eed59629a9eb677526f6d94c.png" alt="OS_INSTALL_VBOX_2">   </p><ol start="3"><li>完成后关闭磁盘工具，选择安装MacOS   </li></ol><p><img src="https://img.vim-cn.com/99/f212f321532bf8967182ac44ad6d49097ac47f.png" alt="OS_INSTALL_VBOX_3"></p><ol start="4"><li>一路下一步，选择安装到刚才抹掉的磁盘中后请耐心等待重启   </li></ol><p><img src="https://img.vim-cn.com/d2/c6f93d83f5a321f633676a84bda44468432413.png" alt="OS_INSTALL_VBOX_4"> </p><ol start="5"><li>重启后再次进入BIOS中选择Boot Maintenance Mamager&gt;&gt;Boot From File&gt;&gt;”\,xxxxxxxxxx(<strong>带有SATA字样</strong>)”&gt;&gt;MacOS Install Data&gt;&gt;Locked Files&gt;&gt;Boot Files&gt;&gt;boot.efi并耐心等待</li></ol><p><img src="https://img.vim-cn.com/64/9609d8f07477fa5b743beca62df8a6e30372d7.png" alt="EFI_INSTALL">   </p><ol start="6"><li>安装完成后便进入系统自定义设置部分，一路下一步即可   </li></ol><blockquote><p><strong>注意：在自定义设置中尽量不要连接网络</strong></p><p><img src="https://img.vim-cn.com/d6/7ec4fb4e02470d5b6c5f07ba6580566d807b62.png" alt="NoNetwork">  </p></blockquote><h3 id="Clover-的安装"><a href="#Clover-的安装" class="headerlink" title="Clover 的安装"></a>Clover 的安装</h3><ol><li>将优盘挂载到虚拟机中   </li><li>打开终端并输入以下命令   </li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diskutil list</span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/79/551cad538f4baf12fc9aa84512caccbe38dda6.png" alt="Mount_Udisk_1">   </p><ol start="3"><li>找到你优盘的EFI分区的 IDENTIFIER ，例如，我的是disk2s1，则输入以下命令   </li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo diskutil mount disk2s1</span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/b9/848eb21a9dd36f0c4669f2a4d372b4f5825c29.png" alt="Mount_Udisk_2">   </p><ol start="4"><li>将EFI 里的文件复制到桌面备用并删除优盘EFI分区的文件   </li><li>下载<a href="https://sourceforge.net/projects/cloverefiboot/" target="_blank" rel="noopener">Clover</a>并打开   </li><li>选择安装到你的优盘中   </li><li>点击自定，并依次勾选以下设置</li></ol><blockquote><p>仅安装UEFI开机版本<br>安装RCScripts到目标磁区<br>UEFIDrivers和 FileVault2 UEFIDrivers中勾选下列选项</p><blockquote><p>AptioMemoryFix-64.efi    DataHubDxe-64.efi    HFSPlus.efi        SMCHelper-64.efi<br>AppleImageLoader-64.efi    AudioDxe-64.efi        EmuVariableUefi-64.efi    NvmExpressDxe-64.efi    VirtualSmc.efi<br>AptioInputFix-64.efi    CsmVideoDxe-64.efi    FSInject-64.efi        OsxAptioFix3Drv-64.efi</p></blockquote></blockquote><ol start="8"><li>检查无误后点击确定，输入密码安装即可   </li></ol><h3 id="EFI文件的初步配置"><a href="#EFI文件的初步配置" class="headerlink" title="EFI文件的初步配置"></a>EFI文件的初步配置</h3><ol><li>下载<a href="https://github.com/jwise/HoRNDIS/releases" target="_blank" rel="noopener">HoRNDIS</a>并放到优盘EFI分区下(安装系统完成之后进行安装)   </li><li>下载 <a href="https://mackie100projects.altervista.org/download-clover-configurator/" target="_blank" rel="noopener">Clover Configurator</a> 保存到桌面备用   </li><li>打开终端，依次输入以下命令   </li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> Desktop</span><br><span class="line">mkdir project &amp;&amp; <span class="built_in">cd</span> project</span><br><span class="line">curl -O https://raw.githubusercontent.com/RehabMan/OS-X-Clover-Laptop-Config/master/config_HD615_620_630_640_650.plist</span><br><span class="line">curl -O https://github.com/Erf172/Lenovo_XiaoXin_Rui7000_Hackintosh/raw/10.13/CLOVER/drivers64UEFI/ApfsDriverLoader-64.efi</span><br></pre></td></tr></table></figure><ol start="4"><li>打开project,复制config_HD615_620_630_640_650.plist到优盘的EFI&gt;&gt;Clover下并将其改名为config.plist   </li><li>打开 Clover Configurator，选择优盘EFI目录下的config.plist文件依次进行以下的设置并保存</li></ol><blockquote><p>Boot&gt;Arguments 中右键添加”-v -debug=0x100 -nv_disable=1”选项<br>Devices 中删除所有Add Properties选项<br>Graphics 取消Inject ATI、Inject NVIDIA选项<br>SMIBIOS 设置成MacBook Pro14,1</p></blockquote><ol start="6"><li>分别下载以下文件，并放到EFI&gt;&gt;Clover&gt;&gt;kexts&gt;&gt;others</li></ol><blockquote><p><a href="https://github.com/acidanthera/VirtualSMC/releases" target="_blank" rel="noopener">VirtualSMC.kext</a><br><a href="https://github.com/acidanthera/VirtualSMC/releases" target="_blank" rel="noopener">SMCBatteryManager.kext</a><br><a href="https://bitbucket.org/RehabMan/os-x-usb-inject-all/downloads/" target="_blank" rel="noopener">USBInjectALL.kext</a><br><a href="https://github.com/acidanthera/Lilu/releases" target="_blank" rel="noopener">Lilu.kext</a><br><a href="https://github.com/acidanthera/WhateverGreen/releases" target="_blank" rel="noopener">WhateverGreen.kext</a><br><a href="https://bitbucket.org/RehabMan/os-x-voodoo-ps2-controller/downloads/" target="_blank" rel="noopener">VoodooPS2Controller.kext</a><br><a href="https://bitbucket.org/RehabMan/os-x-realtek-network/downloads/" target="_blank" rel="noopener">RealtekRTL8111.kext</a><br><a href="http://forum.osxlatitude.com/index.php?/topic/1948-elan-focaltech-and-synaptics-smart-touchpad-driver-mac-os-x/" target="_blank" rel="noopener">ApplePS2SmartTouchpad.kext</a><br><a href="https://github.com/al3xtjames/NoTouchID/releases" target="_blank" rel="noopener">NoTouchID.kext</a></p></blockquote><ol start="7"><li>将project下的ApfsDriverLoader-64.efi与VirtualSMC文件夹下的VirtualSMC.efi复制EFI&gt;&gt;Clover&gt;&gt;drivers64UEFI下</li></ol><p>最后，他们看起来应该是这个样子的</p><p><img src="https://img.vim-cn.com/10/be19b182d21c762ce841dd33a17e9dfce63282.png" alt="EFI_INS_DONE">   </p><h3 id="压缩磁盘，分出相应的安装空间"><a href="#压缩磁盘，分出相应的安装空间" class="headerlink" title="压缩磁盘，分出相应的安装空间"></a>压缩磁盘，分出相应的安装空间</h3><ol><li>右击计算机，依次点击管理&gt;磁盘管理   </li></ol><p><img src="https://img.vim-cn.com/84/9c09729a87961e49328782421872f4417e7ba9.png" alt="DISK_MAN_1"></p><ol start="2"><li>右击你想要压缩的磁盘，选择压缩卷，在弹出来的对话框中选择合适的大小(建议不小于40G)并点击确定   </li></ol><p><img src="https://img.vim-cn.com/95/11ce96ae893d8b42e083528624d0c4ef5a6fec.png" alt="DISK_MAN_2"></p><ol start="3"><li>右击压缩出现的空白区域，选择创建简单卷，一路下一步即可   </li></ol><p><img src="https://img.vim-cn.com/ae/c4b358317a255cdd4ed384767b6e1b318ccadb.png" alt="DISK_MAN_3"></p><p>至此，黑苹果前期的准备工作就OK了，下面将进入正式的安装阶段</p><h3 id="Bios的相关设置"><a href="#Bios的相关设置" class="headerlink" title="Bios的相关设置"></a>Bios的相关设置</h3><ol><li>用以下三种方法中的一种进入电脑的bios</li></ol><blockquote><p>在关机的状态下用尖锐物品按一下右侧的重启按键<br>开机的时候狂按F2或者Fn+F2<br>在Windows 10中，按住shift键并点击重启，依次点击高级选项&gt;UEFI固件设置</p></blockquote><ol start="2"><li>在进入的Bios界面中依次设置以下选项</li></ol><blockquote><p>Security&gt;Secure Boot&gt;Disabled</p><p>Boot&gt;Boot Priority Order&gt;优盘选项移动到最顶端</p></blockquote><ol start="3"><li>确认设置无误后，按下F10或者Fn+F10进行保存。如果一切正常的话，就可以引导进入Clover的引导界面</li></ol><h2 id="正式的安装步骤"><a href="#正式的安装步骤" class="headerlink" title="正式的安装步骤"></a>正式的安装步骤</h2><ol><li>在Clover BOOT引导界面中，选择Boot OS X Install From xxx(xxx为你的优盘名称)   </li></ol><p><img src="https://img.vim-cn.com/1d/8fb687588cb3f6f1f89add819781395d52e162.png" alt="CLOVER"></p><ol start="2"><li><p>稍等片刻即可进入安装过程，此过程的安装步骤与在虚拟机的安装步骤相似，参考上文进行安装即可   </p></li><li><p>安装完成后会自动重启，再次进入Clover的引导界面，会发现多出几个选项，选择安装Boot OS X install From yyy(非优盘项)   </p></li><li><p>下面便进入自动安装的过程，可能会重启几次，耐心等待即可。   </p></li><li><p>安装完成后再引导界面选择boot macOS from xxx(xxx为你的安装磁盘名称名称)   </p></li><li><p>稍等片刻进入个性化设置阶段，视情况设置即可   </p></li><li><p>设置完成之后进入桌面，至此，黑苹果的系统安装完毕。</p></li></ol><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>至此为止，我们的安装阶段就完成了。恭喜你已经完成了一个小小的开头。因为进入系统后，你可能会发现这只是安装了系统而已，什么东西都是残的。什么功能都是不完整的。<br>你可能会怀疑人生，为什么折腾这么久才完成了一个小小的开头。不要慌张，不要心急，最麻烦的地方不在于安装系统，而是对EFI文件进行调整。在下一篇文章中，我将会告诉大家如何进行系黑苹果配置工作。让他能够更加完美。<br>为什么不分开来写呢，应为调整的过程实在是太长了，如果一篇文章写下来的话，可能我连自己写下去的耐心都不会有。<del>才不是为了凑一下文章的数目</del><br>下一篇文章我会尽快写完的<del>坚决不是flag.jpg</del></p><p>传送门 ： <a href="https://www.erf172.tk/2019/02/18/Hackintosh-Installation-on-Lenovo-Xiaoxin-Rui7000-2/" target="_blank" rel="noopener">联想小新锐7000の黑苹果折腾记(二)</a></p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;在经历了让人头秃的期末考试之后，终于可以着手继续折腾黑苹果了2333333&lt;br&gt;经过无数次翻车与删库跑路之后，终于调整成了可以使用的样子，特此记录一下下，怀念我失去的头发。。。。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Guide" scheme="/categories/Guide/"/>
    
    
      <category term="MacOS" scheme="/tags/MacOS/"/>
    
      <category term="系统安装" scheme="/tags/%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/"/>
    
  </entry>
  
  <entry>
    <title>Linux不能正常安装或启动の部分解决方法</title>
    <link href="/2018/12/01/how-to-slove-Linux-cannot-boot/"/>
    <id>/2018/12/01/how-to-slove-Linux-cannot-boot/</id>
    <published>2018-12-01T11:25:19.000Z</published>
    <updated>2019-03-10T06:54:01.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>前段时间安装Linux。结果安装过程各种各种报错接踵而来。。。<br>查了半天资料，问题也解决的差不多了。特此记录一下下。</p></blockquote><a id="more"></a><h2 id="适用情况"><a href="#适用情况" class="headerlink" title="适用情况"></a>适用情况</h2><p>这篇文章适用于以下问题的解决方案</p><blockquote><ol><li>无法进入安装界面，疯狂刷“pci bus error“等类似的错误信息</li><li>安装完成后，启动时无法进入桌面。</li><li>进入桌面后重启/注销卡住，无法正常重启/注销</li><li>更新了内核或一些软件后出现以上的问题</li></ol></blockquote><p><strong>以下的解决方法均以Manjaro 18.0为例。不同Linux发行版的操作方式大同小异</strong></p><h2 id="解决方法A————禁用nouveau"><a href="#解决方法A————禁用nouveau" class="headerlink" title="解决方法A————禁用nouveau"></a>解决方法A————禁用nouveau</h2><p>报错的原因有一部分是因为Linux自带的nouveau驱动存在问题，所以才会导致安装出现上述问题。所以，我们只要将其自带的驱动禁用掉即可解决</p><h3 id="安装过程禁用"><a href="#安装过程禁用" class="headerlink" title="安装过程禁用"></a>安装过程禁用</h3><ol><li>在优盘引导安装的界面中，<strong>不要直接进行安装</strong>。移动到BOOT：xxx 后，按一下e键进入grub的编辑模式</li></ol><p><img src="https://img.vim-cn.com/46/678b75cb6f8aaafad0eca3356e8cd1cf80174c.png" alt="编辑模式" title="移到Boot下按E进入编辑模式"> </p><ol start="2"><li><p>在grub的编辑模式中，找到Linux的那一行，在最后面添加一下信息</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe.blacklist=nouveau</span><br></pre></td></tr></table></figure></li></ol><p><img src="https://img.vim-cn.com/1a/05b9c334e2ec3398e97c7bbe16cdb3235daa20.png" alt="添加信息" title="添加信息"></p><ol start="3"><li>添加完成后，按下Ctrl+X或者F10 进行安装。便可以进行正常的安装</li></ol><p><img src="https://img.vim-cn.com/28/bf78ddae8dcab17bc6afd55722ff0f53b62480.png" alt="可以安装了" title="可以正常安装"></p><ol start="4"><li><p>第一次启动安装后可以按照以上操作步骤进行操作即可进入桌面</p><p>（或者如果是因为更新造成的问题，可以在grub引导界面中选择低版本的内核启动）</p></li></ol><h3 id="进入启动过程后修改启动文件"><a href="#进入启动过程后修改启动文件" class="headerlink" title="进入启动过程后修改启动文件"></a>进入启动过程后修改启动文件</h3><ol><li>打开终端，修改 /etc/default/grub</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo vi /etc/default/grub</span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/fd/e6ce5005877d949ac833f1889b5402231952e8.png" alt="bash_grub" title="修改grub文件"></p><ol start="2"><li>在 GRUB_CMDLINE_LINUX_DEFAULT 行中添加以下内容并保存</li></ol><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">modprobe.blacklist=nouveau</span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/6a/42fdd5650e185d9d3776e932017db58f36bbd7.png" alt="grub修改" title="修改文件"> </p><ol start="3"><li>修改完成后更新grub引导</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo update-grub</span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/f0/ecab2cbe7d74fae7ff7927a0f96e85b639d8d3.png" alt="更新grub" title="更新grub"></p><p>至此系统便可以正常使用了</p><h2 id="解决方法B————安装较低版本内核"><a href="#解决方法B————安装较低版本内核" class="headerlink" title="解决方法B————安装较低版本内核"></a>解决方法B————安装较低版本内核</h2><p>如果上面的方法不好使，可以使用一下的方法进行解决</p><h3 id="进入Bios设置，禁用独立显卡、无线网卡"><a href="#进入Bios设置，禁用独立显卡、无线网卡" class="headerlink" title="进入Bios设置，禁用独立显卡、无线网卡"></a>进入Bios设置，禁用独立显卡、无线网卡</h3><h3 id="按照正常安装方式进行安装"><a href="#按照正常安装方式进行安装" class="headerlink" title="按照正常安装方式进行安装"></a>按照正常安装方式进行安装</h3><h3 id="进入系统桌面后，手动安装Linux-4-9-x版本的内核并重启"><a href="#进入系统桌面后，手动安装Linux-4-9-x版本的内核并重启" class="headerlink" title="进入系统桌面后，手动安装Linux 4.9.x版本的内核并重启"></a>进入系统桌面后，手动安装Linux 4.9.x版本的内核并重启</h3><p>至此系统便也可以正常使用了</p><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>上面的解决方法，个人感觉第一种方法解决的比较彻底。第二中我也用过一段时间（4.9的内核苟了大半年。。。），感觉只可以临时解决问题，并不是长久之计。</p><p>（不是所有的电脑都能完美的安装Linux，现在这句话我是信的233333）</p><p>第二篇文章终于写完了，差不多就这样吧。下篇文章再见！</p><p>(写点什么好呢。。。。)</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;前段时间安装Linux。结果安装过程各种各种报错接踵而来。。。&lt;br&gt;查了半天资料，问题也解决的差不多了。特此记录一下下。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Guide" scheme="/categories/Guide/"/>
    
    
      <category term="系统安装" scheme="/tags/%E7%B3%BB%E7%BB%9F%E5%AE%89%E8%A3%85/"/>
    
      <category term="Linux" scheme="/tags/Linux/"/>
    
  </entry>
  
  <entry>
    <title>删除优盘病毒の不完全教程</title>
    <link href="/2018/11/29/how-to-remove-virus-from-udisk/"/>
    <id>/2018/11/29/how-to-remove-virus-from-udisk/</id>
    <published>2018-11-28T20:41:53.000Z</published>
    <updated>2018-11-29T09:23:06.000Z</updated>
    
    <content type="html"><![CDATA[<blockquote><p>今天去打印店打印东西。回来后发现自己的优盘<strong>又中病毒了</strong>。。。。（等等，我为什么说又。。。）<br>既然中毒了，那么就得清理一下。。。。。</p></blockquote><a id="more"></a><h2 id="将资源管理器设置成显示所有文件"><a href="#将资源管理器设置成显示所有文件" class="headerlink" title="将资源管理器设置成显示所有文件"></a>将资源管理器设置成显示所有文件</h2><ol><li>打开我的电脑&gt;&gt;查看&gt;&gt;选项</li></ol><p><img src="https://img.vim-cn.com/ff/8106eb2eb568546b83cd5766347538932a0d83.png" alt="我的电脑"></p><ol start="2"><li>在打开的文件夹选项中取消“隐藏受保护的系统文件(推荐)”并选择“显示所有文件和文件夹”</li></ol><p><img src="https://img.vim-cn.com/74/45e5f54584c40446e67ed096c6f4106d6ddb7d.png" alt="文件夹选项"></p><h2 id="删除病毒"><a href="#删除病毒" class="headerlink" title="删除病毒"></a>删除病毒</h2><ol><li><strong>右击</strong>打开被感染的优盘，<strong>一定要右击</strong>，防止中病毒</li></ol><p><img src="https://img.vim-cn.com/93/1417f6e3b09a9ec3f09fcdc68c727c9ac33df8.png" alt="右击"></p><ol start="2"><li>将快捷方式删除掉，还有那个病毒.exe </li></ol><p><img src="https://img.vim-cn.com/b3/92f35d209a8942dd31ea8a9c905304bf53ec70.png" alt="删除"></p><h2 id="将文件夹及文件设置成可见"><a href="#将文件夹及文件设置成可见" class="headerlink" title="将文件夹及文件设置成可见"></a>将文件夹及文件设置成可见</h2><ol><li>在打开的盘界面中按住shift键右击，选择在“此处打开命令窗口/powershell”</li></ol><p><img src="https://img.vim-cn.com/bf/8239e5d35a001f5e4a0492137062432ac7ad9d.png" alt="powershell"></p><ol start="2"><li>输入以下命令</li></ol><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">attrib * -s -h -r -a /D</span><br></pre></td></tr></table></figure><p><img src="https://img.vim-cn.com/c3/5e655bd9dc7e7cb9439877ed461f40b573e0a0.png" alt="bash"></p><p>至此，优盘的病毒就会清理干净了。</p><p><img src="https://img.vim-cn.com/12/724a3b4e86a5d74230cadc62310266c8e40ada.png" alt="done"></p><h2 id="注意事项"><a href="#注意事项" class="headerlink" title="注意事项"></a>注意事项</h2><ol><li><p>优盘<strong>不要直接打开，不要直接打开，不要直接打开。</strong></p></li><li><p>优盘<strong>一定要点击右键&gt;&gt;打开</strong></p></li><li><p>如果电脑不小心中毒，<strong>最好重装系统</strong>，360什么的杀不净的。</p></li></ol><h2 id="后记"><a href="#后记" class="headerlink" title="后记"></a>后记</h2><p>一直想要出一个怎么清理优盘病毒的教程，毕竟学校是这种东西的高发区。。。但是我总是遇不到。。。</p><p>其实这两天想要填一下坑的，谁知道半路杀出一个程咬金。不过也好把这个教程出了。。</p><p>继续填坑去了</p>]]></content>
    
    <summary type="html">
    
      &lt;blockquote&gt;
&lt;p&gt;今天去打印店打印东西。回来后发现自己的优盘&lt;strong&gt;又中病毒了&lt;/strong&gt;。。。。（等等，我为什么说又。。。）&lt;br&gt;既然中毒了，那么就得清理一下。。。。。&lt;/p&gt;
&lt;/blockquote&gt;
    
    </summary>
    
      <category term="Guide" scheme="/categories/Guide/"/>
    
    
      <category term="优盘" scheme="/tags/%E4%BC%98%E7%9B%98/"/>
    
      <category term="删除病毒" scheme="/tags/%E5%88%A0%E9%99%A4%E7%97%85%E6%AF%92/"/>
    
  </entry>
  
  <entry>
    <title>Hello World</title>
    <link href="/2018/11/25/hello-world/"/>
    <id>/2018/11/25/hello-world/</id>
    <published>2018-11-25T08:52:48.000Z</published>
    <updated>2019-02-16T12:16:03.000Z</updated>
    
    <content type="html"><![CDATA[<h3 id="你好，欢迎来到我的小站"><a href="#你好，欢迎来到我的小站" class="headerlink" title="你好，欢迎来到我的小站"></a>你好，欢迎来到我的小站</h3><p>在这里我将会不定期更新一些教程，一些翻车时刻，还有一些杂七杂八的东西</p><p>请使用IE，360极速浏览器访问的同学或使用较低操作系统版本的同学移步<a href="https://www.google.cn/chrome/" target="_blank" rel="noopener">Chrome</a>或<a href="http://www.firefox.com.cn/" target="_blank" rel="noopener">Firefox</a>。</p><p>部分素材来自互联网，如有侵权请与<a href="mailto:fzx172@126.com" target="_blank" rel="noopener">fzx172@126.com</a>联系删除！</p><a id="more"></a><p>下面便是填坑时间了，慢慢填坑中。。。。。。</p><h2 id="关于"><a href="#关于" class="headerlink" title="关于"></a>关于</h2><p>这不是lD ，一所普普通通的大学中的一名普普通通的大二医学狗。</p><p>喜欢折腾电脑，肥宅一枚，休伯利安洗甲工一枚。</p><p>日常咸鱼，有时折腾，时常翻车。</p><p><img src="https://img.vim-cn.com/8e/fe167c13c56601ecdd22fac31f2513a9d24d19.png" alt="hello_bash"></p><p>本站使用<a href="https://xaoxuu.com/wiki/material-x/" target="_blank" rel="noopener">Material X</a>作为主题，喜欢这个主题的朋友可以阅读文档进行安装哦。</p>]]></content>
    
    <summary type="html">
    
      &lt;h3 id=&quot;你好，欢迎来到我的小站&quot;&gt;&lt;a href=&quot;#你好，欢迎来到我的小站&quot; class=&quot;headerlink&quot; title=&quot;你好，欢迎来到我的小站&quot;&gt;&lt;/a&gt;你好，欢迎来到我的小站&lt;/h3&gt;&lt;p&gt;在这里我将会不定期更新一些教程，一些翻车时刻，还有一些杂七杂八的东西&lt;/p&gt;
&lt;p&gt;请使用IE，360极速浏览器访问的同学或使用较低操作系统版本的同学移步&lt;a href=&quot;https://www.google.cn/chrome/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Chrome&lt;/a&gt;或&lt;a href=&quot;http://www.firefox.com.cn/&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;Firefox&lt;/a&gt;。&lt;/p&gt;
&lt;p&gt;部分素材来自互联网，如有侵权请与&lt;a href=&quot;mailto:fzx172@126.com&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;fzx172@126.com&lt;/a&gt;联系删除！&lt;/p&gt;
    
    </summary>
    
      <category term="Others" scheme="/categories/Others/"/>
    
    
      <category term="置顶" scheme="/tags/%E7%BD%AE%E9%A1%B6/"/>
    
      <category term="欢迎" scheme="/tags/%E6%AC%A2%E8%BF%8E/"/>
    
  </entry>
  
</feed>
